
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HandiCricket - Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { background: #061e3e; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
    .card-row { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    button.card { width: 60px; height: 60px; font-size: 20px; border-radius: 12px; border: none; background: #1e88e5; color: white; }
    button.card:disabled { background: #607d8b; color: #ccc; }
    #scoreboard { margin-top: 20px; font-size: 18px; }
    #status { margin-top: 15px; font-size: 16px; color: #ffeb3b; }
  </style>
</head>
<body>
  <h2>üèè HandiCricket - Game</h2>
  <div id="scoreboard">Runs: 0 | Wickets: 0 | Overs: 0.0</div>
  <div id="joinStatus" style="color: lightgreen; font-size: 14px; margin-bottom: 10px;"></div>
<button id="startMatchBtn" style="display:none; margin-bottom:10px;">Start Match</button>
<div id="status">Waiting for players...</div>

  <div class="card-row" id="cardButtons">
    <button class="card" data-value="0">0</button>
    <button class="card" data-value="1">1</button>
    <button class="card" data-value="2">2</button>
    <button class="card" data-value="3">3</button>
    <button class="card" data-value="4">4</button>
    <button class="card" data-value="5">5</button>
    <button class="card" data-value="6">6</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, update } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGU0Tsj9pwZcgwQjZzTFvGOE032l2b7HI",
      authDomain: "handicricket-d1ab7.firebaseapp.com",
      projectId: "handicricket-d1ab7",
      storageBucket: "handicricket-d1ab7.appspot.com",
      messagingSenderId: "356065986337",
      appId: "1:356065986337:web:399102c5dabfca2b6fe060"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const params = new URLSearchParams(window.location.search);
    const room = params.get('room');
    const player = params.get('player');
    const opponent = player === "player1" ? "player2" : "player1";

    let runs = 0, wickets = 0, balls = 0;

    const status = document.getElementById("status");
    const scoreboard = document.getElementById("scoreboard");
    const buttons = document.querySelectorAll(".card");

    // CLEANED: disableButtons
  buttons.forEach(btn => {
    btn.disabled = true;
    btn.style.opacity = 0.5;
  });
}
      buttons.forEach(btn => { btn.disabled = true; btn.style.opacity = 0.5; });
    }

    // CLEANED: enableButtons
  buttons.forEach(btn => {
    btn.disabled = false;
    btn.style.opacity = 1;
  });
}
      buttons.forEach(btn => { btn.disabled = false; btn.style.opacity = 1; });
    }

    function updateScoreboard() {
    if (balls > 0 && balls % 6 === 0) {
      overs++;
      balls = 0;
      status.innerText = `Over ${overs} completed`;
    }
      scoreboard.textContent = `Runs: ${runs} | Wickets: ${wickets} | Overs: ${(balls / 6).toFixed(1)}`;
    }

    function resetPlays() {
      set(ref(db, `rooms/${room}/currentPlays`), { player1: null, player2: null });
    }

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const val = parseInt(btn.dataset.value);
        disableButtons();
        status.innerText = "Waiting for opponent...";
        set(ref(db, `rooms/${room}/currentPlays/${player}`), val);
      });
    });

    onValue(ref(db, `rooms/${room}/currentPlays`), (snap) => {
      const plays = snap.val();
      if (!plays || plays.player1 == null || plays.player2 == null) return;

      get(ref(db, `rooms/${room}/tossWinner`)).then((snap) => {
  const tossWinner = snap.val();
  const bat = plays[tossWinner];
        const bowl = plays[tossWinner === "player1" ? "player2" : "player1"];
  // game logic continues here
});

      let outcome = "";

      if (bat === bowl && bat > 0) {
        outcome = "WICKET!";
        wickets++;
      } else if (bat === 0 && bowl === 0) {
        outcome = "NO BALL!";
        runs += 1;
        // no ball: do not count the ball
      } else if (bat === 0 && bowl > 0) {
        runs += bowl;
        outcome = `Batter played 0. Runs = ${bowl}`;
        balls++;
      } else if (bowl === 0 && bat > 0) {
        outcome = "DOT BALL!";
        balls++;
      } else {
        runs += bat;
        outcome = `${bat} Run(s)!`;
        balls++;
      }

      status.innerText = outcome;
      updateScoreboard();
      if (!isSecondInnings && (overs === 2 || wickets === 2)) {
        status.innerText = "Innings Over! Switching Roles...";
        setTimeout(() => {
          runs = 0; wickets = 0; balls = 0; overs = 0;
          isSecondInnings = true;
          // Swap tossWinner for second innings
          get(ref(db, `rooms/${room}/tossWinner`)).then(snap => {
            const prev = snap.val();
            const newWinner = prev === 'player1' ? 'player2' : 'player1';
            set(ref(db, `rooms/${room}/tossWinner`), newWinner);
          });
          updateScoreboard();
          resetPlays();
          setTimeout(() => enableButtons(), 100);
          status.innerText = "Second Innings Started! Play your card.";
        }, 3000);
        return;
      }
        resetPlays();
        setTimeout(() => enableButtons(), 100);
        status.innerText = "Play your next card.";
      }, 1500);
    });

    updateScoreboard();
  </script>
</body>
</html>



function enableButtons() {
  document.querySelectorAll(".card-btn").forEach(btn => {
    btn.disabled = false;
    btn.style.opacity = "1";
  });
}

function disableButtons() {
  document.querySelectorAll(".card-btn").forEach(btn => {
    btn.disabled = true;
    btn.style.opacity = "0.5";
  });
}
