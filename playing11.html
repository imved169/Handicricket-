<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select Playing XI | HandiCricket</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
    }
    
    .format-selector {
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .format-selector select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-top: 10px;
    }
    
    .team-selection {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .player-list, .selected-team {
      flex: 1;
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      height: 500px;
      overflow-y: auto;
    }
    
    h3 {
      margin-top: 0;
      color: #2c3e50;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    
    ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
    
    li {
      padding: 10px;
      margin: 5px 0;
      background-color: #f9f9f9;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    li:hover {
      background-color: #e0e0e0;
    }
    
    .selected-team li {
      background-color: #e3f2fd;
    }
    
    .selected-team li:hover {
      background-color: #bbdefb;
    }
    
    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .btn:hover {
      background-color: #2980b9;
    }
    
    .btn:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Select Your Playing XI</h1>
    
    <div class="format-selector">
      <h3>Select Match Format:</h3>
      <select id="match-format">
        <option value="5">5 Overs</option>
        <option value="10">10 Overs</option>
        <option value="20" selected>20 Overs (T20)</option>
        <option value="50">50 Overs (ODI)</option>
        <option value="test">Test Match</option>
      </select>
    </div>
    
    <div class="team-selection">
      <div class="player-list">
        <h3>Available Players</h3>
        <ul id="available-players">
          <!-- Will be populated by JS -->
        </ul>
      </div>
      
      <div class="selected-team">
        <h3>Your Team (0/11)</h3>
        <ul id="selected-players"></ul>
      </div>
    </div>
    
    <button id="confirm-team" class="btn" disabled>Confirm Team</button>
  </div>

  <script type="module">
    import { db, ref, set, onValue } from './firebase.js';
    
    const roomId = localStorage.getItem('roomId');
    const player = localStorage.getItem('player');
    const availablePlayers = [
      "Rohit Sharma", "Virat Kohli", "MS Dhoni", "Rishabh Pant", 
      "Ravindra Jadeja", "Jasprit Bumrah", "Mohammed Shami",
      "KL Rahul", "Hardik Pandya", "Ravichandran Ashwin", 
      "Shreyas Iyer", "Ishan Kishan", "Suryakumar Yadav", "Yuzvendra Chahal"
    ];
    
    const availablePlayersList = document.getElementById('available-players');
    const selectedPlayersList = document.getElementById('selected-players');
    const confirmBtn = document.getElementById('confirm-team');
    let selectedPlayers = [];
    
    // Populate available players
    function populatePlayers() {
      availablePlayersList.innerHTML = '';
      availablePlayers.forEach(player => {
        if (!selectedPlayers.includes(player)) {
          const li = document.createElement('li');
          li.textContent = player;
          li.addEventListener('click', () => selectPlayer(player, li));
          availablePlayersList.appendChild(li);
        }
      });
    }
    
    function selectPlayer(player, element) {
      if (selectedPlayers.length >= 11) {
        alert('You can only select 11 players!');
        return;
      }
      
      selectedPlayers.push(player);
      element.remove();
      updateSelectedTeam();
      
      if (selectedPlayers.length === 11) {
        confirmBtn.disabled = false;
      }
    }
    
    function updateSelectedTeam() {
      selectedPlayersList.innerHTML = '';
      selectedPlayers.forEach((player, index) => {
        const li = document.createElement('li');
        li.textContent = `${index + 1}. ${player}`;
        li.addEventListener('click', () => deselectPlayer(player, li));
        selectedPlayersList.appendChild(li);
      });
      
      document.querySelector('.selected-team h3').textContent = 
        `Your Team (${selectedPlayers.length}/11)`;
    }
    
    function deselectPlayer(player, element) {
      selectedPlayers = selectedPlayers.filter(p => p !== player);
      element.remove();
      updateSelectedTeam();
      populatePlayers();
      
      confirmBtn.disabled = selectedPlayers.length !== 11;
    }
    
    confirmBtn.addEventListener('click', async () => {
      const format = document.getElementById('match-format').value;
      
      // Validate team selection
      if (selectedPlayers.length !== 11) {
        alert('Please select exactly 11 players!');
        return;
      }
      
      // Save team to localStorage
      if (player === 'player1') {
        localStorage.setItem('team1', JSON.stringify(selectedPlayers));
        localStorage.setItem('team1Name', 'Team 1');
      } else {
        localStorage.setItem('team2', JSON.stringify(selectedPlayers));
        localStorage.setItem('team2Name', 'Team 2');
      }
      localStorage.setItem('format', format);
      
      try {
        // Save team to Firebase
        await set(ref(db, `rooms/${roomId}/teams/${player}`), {
          players: selectedPlayers,
          format: format
        });
        
        // Show confirmation
        confirmBtn.textContent = 'Team Submitted!';
        confirmBtn.style.backgroundColor = '#27ae60';
        
        // Wait for opponent's team
        const teamsRef = ref(db, `rooms/${roomId}/teams`);
        onValue(teamsRef, (snapshot) => {
          const teams = snapshot.val();
          if (teams && teams.player1 && teams.player2) {
            // Both teams submitted
            window.location.href = 'toss.html';
          }
        }, { onlyOnce: false });
        
      } catch (error) {
        console.error('Error saving team:', error);
        alert('Error saving team. Please try again.');
        confirmBtn.textContent = 'Confirm Team';
        confirmBtn.style.backgroundColor = '#3498db';
      }
    });
    
    // Initialize the player lists
    populatePlayers();
  </script>
</body>
</html>
