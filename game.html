
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HandiCricket - Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { background: #061e3e; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
    .card-row { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    button.card { width: 60px; height: 60px; font-size: 20px; border-radius: 12px; border: none; background: #1e88e5; color: white; }
    button.card:disabled { background: #607d8b; color: #ccc; }
  </style>
</head>
<body>
  <h1>üèè HandiCricket - Game</h1>
  <div id="scoreboard">Runs: 0 | Wickets: 0 | Overs: 0.0</div>
  <div class="card-row" id="cardContainer">
  <button class="card" onclick="play(0)">0</button>
  <button class="card" onclick="play(1)">1</button>
  <button class="card" onclick="play(2)">2</button>
  <button class="card" onclick="play(3)">3</button>
  <button class="card" onclick="play(4)">4</button>
  <button class="card" onclick="play(5)">5</button>
  <button class="card" onclick="play(6)">6</button>
</div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    import { AIOpponent } from './ai.js';

    const firebaseConfig = {
      apiKey: "AIzaSyAGU0Tsj9pwZcgwQjZzTFvGOE032l2b7HI",
      authDomain: "handicricket-d1ab7.firebaseapp.com",
      projectId: "handicricket-d1ab7",
      storageBucket: "handicricket-d1ab7.appspot.com",
      messagingSenderId: "356065986337",
      appId: "1:356065986337:web:399102c5dabfca2b6fe060",
      databaseURL: "https://handicricket-d1ab7-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const url = new URLSearchParams(window.location.search);
    const room = url.get("room");
    const player = url.get("player");
    const aiMode = url.get("ai") === "true";

    const stateRef = ref(db, 'rooms/' + room + '/state');
    const opponentAI = new AIOpponent("medium");

    let localTurn = "player1";
    let gameState = { runs: 0, wickets: 0, balls: 0 };

    function updateUI() {
      document.getElementById("scoreboard").innerText = `Runs: ${gameState.runs} | Wickets: ${gameState.wickets} | Overs: ${(gameState.balls / 6).toFixed(1)}`;
    }

    function play(card) {
      if (localTurn !== player) return;
      applyMove(card);
      if (aiMode) {
        const aiCard = opponentAI.playCard(gameState);
        setTimeout(() => applyMove(aiCard, true), 500);
      }
    }

    function applyMove(card, fromAI = false) {
      gameState.runs += card;
      if (card === 5 || card === 6) gameState.wickets++;
      gameState.balls++;

      updateUI();

      // Sync only if multiplayer
      if (!aiMode) {
        set(stateRef, { ...gameState, turn: fromAI ? "player1" : "player2" });
      }
    }

    if (!aiMode) {
      onValue(stateRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          gameState = data;
          localTurn = data.turn;
          updateUI();
        }
      });
    } else {
      updateUI();
    }

    window.play = play;
  </script>
</body>
</html>
