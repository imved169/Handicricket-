<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HandiCricket - First Innings</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(135deg, #061e3e, #0a2a4a);
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      padding: 10px;
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    h1 {
      color: #ffeb3b;
      text-shadow: 0 0 10px rgba(255, 235, 59, 0.5);
      margin-bottom: 15px;
      font-size: 1.8rem;
    }
    
    /* Team Header */
    .team-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(13, 42, 82, 0.5);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .team {
      flex: 1;
      text-align: center;
      padding: 5px;
    }
    
    .team-name {
      font-weight: bold;
      font-size: 1.1rem;
      color: #ffeb3b;
    }
    
    .team-score {
      font-size: 0.9rem;
      color: #aaa;
    }
    
    .vs {
      padding: 0 10px;
      font-weight: bold;
      color: #ffeb3b;
    }
    
    /* Scoreboard */
    .scoreboard {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(13, 42, 82, 0.8);
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    
    .score-main {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    
    .score-large {
      font-size: 2.2rem;
      font-weight: bold;
      color: #ffeb3b;
      line-height: 1;
    }
    
    .score-details {
      text-align: right;
      font-size: 0.9rem;
    }
    
    .score-details div {
      margin: 4px 0;
    }
    
    /* Match Info */
    .match-info {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: rgba(13, 42, 82, 0.5);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.85rem;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .match-info-item {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
      margin-left: 5px;
    }
    
    .powerplay {
      background: rgba(255, 193, 7, 0.3);
      color: #ffc107;
      border: 1px solid #ffc107;
    }
    
    .dead-over {
      background: rgba(158, 158, 158, 0.3);
      color: #9e9e9e;
      border: 1px solid #9e9e9e;
    }
    
    .free-hit {
      background: rgba(76, 175, 80, 0.3);
      color: #4caf50;
      border: 1px solid #4caf50;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    
    /* Player Selection */
    .player-selection {
      margin: 15px 0;
      padding: 12px;
      background: rgba(13, 42, 82, 0.5);
      border-radius: 8px;
      display: none;
    }
    
    .selection-title {
      margin-bottom: 10px;
      font-weight: bold;
      color: #ffeb3b;
    }
    
    .player-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }
    
    .player-btn {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: rgba(30, 136, 229, 0.3);
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }
    
    .player-btn:hover {
      background: rgba(30, 136, 229, 0.5);
    }
    
    .player-btn.selected {
      background: rgba(76, 175, 80, 0.5);
      border: 2px solid #4caf50;
    }
    
    /* Card Buttons */
    .card-buttons {
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    
    .card-btn {
      width: 60px;
      height: 60px;
      font-size: 22px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(145deg, #1e88e5, #1565c0);
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.2s;
      font-weight: bold;
    }
    
    .card-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
      background: linear-gradient(145deg, #2196f3, #1976d2);
    }
    
    .card-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .card-btn:disabled {
      background: #607d8b;
      color: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .card-btn.selected {
      background: #4caf50;
      border: 2px solid #ffeb3b;
      transform: scale(1.05);
    }
    
    /* Result Display */
    .result-display {
      min-height: 60px;
      padding: 12px;
      margin: 15px 0;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 500;
      border-left: 3px solid #1e88e5;
    }
    
    /* Over Progress */
    .over-progress {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      margin: 15px 0;
      overflow: hidden;
    }
    
    .over-progress-bar {
      height: 100%;
      background: linear-gradient(to right, #1e88e5, #1565c0);
      width: 0%;
      transition: width 0.3s;
    }
    
    .balls-container {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .ball {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    .ball.runs {
      background: rgba(76, 175, 80, 0.3);
      color: #4caf50;
    }
    
    .ball.wicket {
      background: rgba(244, 67, 54, 0.3);
      color: #f44336;
    }
    
    .ball.dot {
      background: rgba(158, 158, 158, 0.3);
      color: #9e9e9e;
    }
    
    .ball.extras {
      background: rgba(255, 193, 7, 0.3);
      color: #ffc107;
    }
    
    /* Connection Status */
    .connection-status {
      padding: 8px;
      border-radius: 6px;
      text-align: center;
      margin: 15px auto;
      max-width: 250px;
      font-weight: bold;
      font-size: 0.9rem;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .online {
      background: rgba(76, 175, 80, 0.3);
      color: #4caf50;
      border-color: #4caf50;
    }
    
    .offline {
      background: rgba(244, 67, 54, 0.3);
      color: #f44336;
      border-color: #f44336;
    }
    
    /* Stats Section */
    .stats-section {
      margin: 15px 0;
      padding: 12px;
      background: rgba(13, 42, 82, 0.5);
      border-radius: 8px;
      display: none;
    }
    
    .stats-title {
      margin-bottom: 10px;
      font-weight: bold;
      color: #ffeb3b;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 5px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      text-align: left;
    }
    
    .stat-item {
      padding: 5px;
      font-size: 0.85rem;
    }
    
    /* Innings Summary Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }
    
    .modal-content {
      background: linear-gradient(145deg, #0a2a4a, #061e3e);
      border-radius: 12px;
      padding: 20px;
      max-width: 90%;
      width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .modal-header {
      margin-bottom: 15px;
      text-align: center;
      color: #ffeb3b;
      border-bottom: 2px solid #1e88e5;
      padding-bottom: 10px;
    }
    
    .modal-body {
      margin-bottom: 20px;
    }
    
    .stats-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 0.85rem;
    }
    
    .stats-table th, .stats-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .stats-table th {
      background: rgba(30, 136, 229, 0.3);
      color: #ffeb3b;
    }
    
    .highlight {
      background: rgba(255, 235, 59, 0.2);
      font-weight: bold;
    }
    
    .modal-footer {
      text-align: center;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(145deg, #4CAF50, #2E7D32);
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    
    /* Responsive Adjustments */
    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .score-large {
        font-size: 1.8rem;
      }
      
      .card-btn {
        width: 50px;
        height: 50px;
        font-size: 18px;
      }
      
      .team-header {
        flex-direction: column;
        gap: 8px;
      }
      
      .vs {
        padding: 5px 0;
      }
      
      .match-info {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>HandiCricket - First Innings</h1>
    
    <!-- Team Header -->
    <div class="team-header">
      <div class="team">
        <div class="team-name" id="team1Name">Team A</div>
        <div class="team-score" id="team1Score">0/0 (0.0)</div>
      </div>
      <div class="vs">VS</div>
      <div class="team">
        <div class="team-name" id="team2Name">Team B</div>
        <div class="team-score" id="team2Score">Yet to bat</div>
      </div>
    </div>
    
    <!-- Scoreboard -->
    <div class="scoreboard">
      <div class="score-main">
        <span id="battingTeamName">Team A</span>
        <span class="score-large"><span id="runs">0</span>/<span id="wickets">0</span></span>
      </div>
      <div class="score-details">
        <div>Overs: <strong id="overs">0.0</strong></div>
        <div>Run Rate: <strong id="runRate">0.00</strong></div>
        <div>Req. Rate: <strong id="requiredRate">0.00</strong></div>
      </div>
    </div>
    
    <!-- Match Info -->
    <div class="match-info">
      <div class="match-info-item">
        Format: <span id="formatDisplay">5 Overs</span>
      </div>
      <div class="match-info-item">
        <span id="inningsNumber">1st Innings</span>
        <span class="status-badge" id="powerplayBadge" style="display: none;">Powerplay</span>
        <span class="status-badge" id="deadOverBadge" style="display: none;">Dead Over</span>
        <span class="status-badge" id="freeHitBadge" style="display: none;">Free Hit</span>
      </div>
      <div class="match-info-item">
        <span id="roleText">You are Batting</span>
      </div>
    </div>
    
    <!-- Over Progress -->
    <div class="over-progress">
      <div class="over-progress-bar" id="overProgressBar"></div>
    </div>
    
    <div class="balls-container" id="ballsContainer">
      <!-- Ball indicators will be added here -->
    </div>
    
    <!-- Player Selection -->
    <div class="player-selection" id="batterSelection">
      <div class="selection-title">Select Batter:</div>
      <div class="player-buttons" id="batterButtons">
        <!-- Batter buttons will be added here -->
      </div>
    </div>
    
    <div class="player-selection" id="bowlerSelection">
      <div class="selection-title">Select Bowler:</div>
      <div class="player-buttons" id="bowlerButtons">
        <!-- Bowler buttons will be added here -->
      </div>
    </div>
    
    <!-- Result Display -->
    <div class="result-display" id="result">
      Initializing game...
    </div>
    
    <!-- Card Buttons -->
    <div class="card-buttons" id="cardButtons">
      <button class="card-btn" data-value="0">0</button>
      <button class="card-btn" data-value="1">1</button>
      <button class="card-btn" data-value="2">2</button>
      <button class="card-btn" data-value="3">3</button>
      <button class="card-btn" data-value="4">4</button>
      <button class="card-btn" data-value="5">5</button>
      <button class="card-btn" data-value="6">6</button>
    </div>
    
    <!-- Stats Section -->
    <div class="stats-section" id="statsSection">
      <div class="stats-title">Current Partnership</div>
      <div class="stats-grid">
        <div class="stat-item">Batter 1: <span id="batter1Name">-</span></div>
        <div class="stat-item">Runs: <span id="batter1Runs">0</span></div>
        <div class="stat-item">Batter 2: <span id="batter2Name">-</span></div>
        <div class="stat-item">Runs: <span id="batter2Runs">0</span></div>
        <div class="stat-item">Partnership: <span id="partnershipRuns">0</span></div>
        <div class="stat-item">Balls: <span id="partnershipBalls">0</span></div>
        <div class="stat-item">Bowler: <span id="currentBowler">-</span></div>
        <div class="stat-item">Overs: <span id="bowlerOvers">0.0</span></div>
      </div>
    </div>
    
    <!-- Connection Status -->
    <div class="connection-status online" id="connectionStatus">
      Opponent: Online
    </div>
  </div>
  
  <!-- Innings Summary Modal -->
  <div class="modal-overlay" id="inningsSummaryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>First Innings Summary</h2>
      </div>
      <div class="modal-body">
        <div id="inningsSummaryText">
          Team A scored 0/0 in 0.0 overs (Run Rate: 0.00)
        </div>
        
        <h3>Batting Stats</h3>
        <table class="stats-table">
          <thead>
            <tr>
              <th>Batter</th>
              <th>Runs</th>
              <th>Balls</th>
              <th>4s</th>
              <th>6s</th>
              <th>SR</th>
            </tr>
          </thead>
          <tbody id="battingStatsBody">
            <!-- Batting stats will be added here -->
          </tbody>
        </table>
        
        <h3>Bowling Stats</h3>
        <table class="stats-table">
          <thead>
            <tr>
              <th>Bowler</th>
              <th>Overs</th>
              <th>Runs</th>
              <th>Wkts</th>
              <th>Economy</th>
            </tr>
          </thead>
          <tbody id="bowlingStatsBody">
            <!-- Bowling stats will be added here -->
          </tbody>
        </table>
        
        <div id="inningsHighlights">
          <!-- Highlights will be added here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn" id="startSecondInningsBtn">Start Second Innings</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update, get, push } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCN6aZMwlsZe7JJaovU0WA3UQygWr4jYmA",
      authDomain: "handicricket-85a06.firebaseapp.com",
      projectId: "handicricket-85a06",
      storageBucket: "handicricket-85a06.appspot.com",
      messagingSenderId: "599182538558",
      appId: "1:599182538558:web:3e965753ab05f8f1e3de6f",
      measurementId: "G-HSV9H4LEJQ"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Game Constants
    const FORMAT_RULES = {
      "5": { 
        name: "5 Overs", 
        totalOvers: 5, 
        totalWickets: 10,
        powerplayOvers: 2, 
        powerplayWicketValue: 0.5,
        regularWicketValue: 1.0,
        deadOvers: []
      },
      "10": { 
        name: "10 Overs", 
        totalOvers: 10, 
        totalWickets: 10,
        powerplayOvers: 3, 
        powerplayWicketValue: 0.5,
        regularWicketValue: 1.0,
        deadOvers: []
      },
      "20": { 
        name: "T20", 
        totalOvers: 20, 
        totalWickets: 10,
        powerplayOvers: 6, 
        powerplayWicketValue: 0.5,
        regularWicketValue: 1.0,
        deadOvers: []
      },
      "50": { 
        name: "ODI", 
        totalOvers: 50, 
        totalWickets: 10,
        powerplayOvers: [1,10, 21,30, 41,42], 
        powerplayWicketValue: 0.25,
        regularWicketValue: 0.5,
        deadOvers: [11,20, 31,40, 43,50]
      }
    };

    // CricketGame class
    class CricketGame {
      constructor() {
        // DOM Elements
        this.elements = {
          team1Name: document.getElementById('team1Name'),
          team2Name: document.getElementById('team2Name'),
          team1Score: document.getElementById('team1Score'),
          team2Score: document.getElementById('team2Score'),
          battingTeamName: document.getElementById('battingTeamName'),
          runs: document.getElementById('runs'),
          wickets: document.getElementById('wickets'),
          overs: document.getElementById('overs'),
          runRate: document.getElementById('runRate'),
          requiredRate: document.getElementById('requiredRate'),
          formatDisplay: document.getElementById('formatDisplay'),
          inningsNumber: document.getElementById('inningsNumber'),
          roleText: document.getElementById('roleText'),
          powerplayBadge: document.getElementById('powerplayBadge'),
          deadOverBadge: document.getElementById('deadOverBadge'),
          freeHitBadge: document.getElementById('freeHitBadge'),
          overProgressBar: document.getElementById('overProgressBar'),
          ballsContainer: document.getElementById('ballsContainer'),
          batterSelection: document.getElementById('batterSelection'),
          batterButtons: document.getElementById('batterButtons'),
          bowlerSelection: document.getElementById('bowlerSelection'),
          bowlerButtons: document.getElementById('bowlerButtons'),
          result: document.getElementById('result'),
          cardButtons: document.getElementById('cardButtons'),
          buttons: document.querySelectorAll('.card-btn'),
          connectionStatus: document.getElementById('connectionStatus'),
          statsSection: document.getElementById('statsSection'),
          batter1Name: document.getElementById('batter1Name'),
          batter1Runs: document.getElementById('batter1Runs'),
          batter2Name: document.getElementById('batter2Name'),
          batter2Runs: document.getElementById('batter2Runs'),
          partnershipRuns: document.getElementById('partnershipRuns'),
          partnershipBalls: document.getElementById('partnershipBalls'),
          currentBowler: document.getElementById('currentBowler'),
          bowlerOvers: document.getElementById('bowlerOvers'),
          inningsSummaryModal: document.getElementById('inningsSummaryModal'),
          inningsSummaryText: document.getElementById('inningsSummaryText'),
          battingStatsBody: document.getElementById('battingStatsBody'),
          bowlingStatsBody: document.getElementById('bowlingStatsBody'),
          inningsHighlights: document.getElementById('inningsHighlights'),
          startSecondInningsBtn: document.getElementById('startSecondInningsBtn')
        };

        // Game state
        this.state = {
          // Basic game info
          roomId: null,
          player: null,
          opponent: null,
          teamName: null,
          opponentTeamName: null,
          format: null,
          formatRules: {},
          
          // Toss info
          tossWinner: null,
          battingFirst: null,
          isBatting: false,
          
          // Teams and players
          team1Players: [],
          team2Players: [],
          currentBatter1: null,
          currentBatter2: null,
          currentBowler: null,
          nextBatterIndex: 0,
          
          // Score and match progress
          runs: 0,
          wickets: 0,
          legalBalls: 0,
          totalBalls: 0,
          freeHit: false,
          freeHitNextBall: false,
          isPowerplay: false,
          isDeadOver: false,
          
          // Player stats
          batterStats: {},
          bowlerStats: {},
          partnership: { runs: 0, balls: 0 },
          fallOfWickets: [],
          ballByBall: [],
          
          // Game flow control
          gameInProgress: false,
          batterSelected: false,
          bowlerSelected: false,
          selectedCardValue: null,
          isProcessingSelection: false,
          currentOverBalls: [],
          
          // Firebase data
          firebaseData: {
            player1: { card: null, online: true },
            player2: { card: null, online: true }
          }
        };

        // Get URL parameters
        const params = new URLSearchParams(window.location.search);
        this.state.roomId = params.get('room');
        this.state.player = params.get('player') || 'player1';
        this.state.opponent = this.state.player === "player1" ? "player2" : "player1";

        // Initialize the game
        this.init();
      }

      async init() {
        try {
          console.log("Starting game initialization...");
          this.elements.result.innerText = "Initializing game...";

          if (!this.state.roomId) {
            throw new Error("Missing room parameter in URL");
          }

          // Set up Firebase references
          this.roomRef = ref(db, `rooms/${this.state.roomId}`);
          this.tossRef = ref(db, `rooms/${this.state.roomId}/toss`);
          this.teamsRef = ref(db, `rooms/${this.state.roomId}/teams`);
          this.gameRef = ref(db, `rooms/${this.state.roomId}/game`);
          this.playerRef = ref(db, `rooms/${this.state.roomId}/${this.state.player}`);
          this.opponentRef = ref(db, `rooms/${this.state.roomId}/${this.state.opponent}`);

          // Set player online status
          await set(this.playerRef, {
            connected: true,
            ready: false
          });

          // Load room data
          this.loadRoomData();
          
          // Set up UI components
          this.setupCardButtons();
          this.updateAllDisplays();

        } catch (error) {
          console.error("Initialization failed:", error);
          this.elements.result.innerHTML = `Initialization failed: ${error.message}<br>
                         <button onclick="location.reload()" style="margin-top:10px; padding: 8px 15px; background: #1e88e5; color: white; border: none; border-radius: 5px; cursor: pointer;">
                           Retry
                         </button>`;
        }
      }

      async loadRoomData() {
        // Get room data from Firebase
        const roomSnap = await get(this.roomRef);
        if (!roomSnap.exists()) {
          throw new Error("Room not found");
        }
        
        const roomData = roomSnap.val();
        
        // Set team names
        this.state.teamName = this.state.player === "player1" ? roomData.player1.team : roomData.player2.team;
        this.state.opponentTeamName = this.state.player === "player1" ? roomData.player2.team : roomData.player1.team;
        
        this.elements.team1Name.textContent = roomData.player1.team;
        this.elements.team2Name.textContent = roomData.player2.team;
        
        // Set format
        this.state.format = roomData.format;
        this.state.formatRules = FORMAT_RULES[this.state.format];
        this.elements.formatDisplay.textContent = this.state.formatRules.name;
        
        // Set toss info
        if (roomData.toss) {
          this.state.tossWinner = roomData.toss.winner;
          this.state.battingFirst = roomData.toss.battingFirst;
          this.state.isBatting = (this.state.player === this.state.battingFirst);
          
          this.elements.roleText.textContent = this.state.isBatting ? "You are Batting" : "You are Bowling";
          this.elements.battingTeamName.textContent = this.state.battingFirst === "player1" ? 
            roomData.player1.team : roomData.player2.team;
        }
        
        // Load teams
        if (roomData.teams) {
          this.state.team1Players = roomData.teams.player1?.players || [];
          this.state.team2Players = roomData.teams.player2?.players || [];
          
          // Initialize batter stats
          this.state.team1Players.forEach(player => {
            this.state.batterStats[player] = {
              runs: 0, balls: 0, fours: 0, sixes: 0, out: false
            };
          });
          
          // Initialize bowler stats
          this.state.team2Players.forEach(player => {
            this.state.bowlerStats[player] = {
              runs: 0, balls: 0, wickets: 0, maidens: 0
            };
          });
        }
        
        // Check if game already started
        if (roomData.game && roomData.game.started) {
          this.loadGameState(roomData.game);
        } else {
          // Start new game
          this.startNewGame();
        }
        
        // Set up opponent connection monitoring
        this.monitorOpponentConnection();
      }

      startNewGame() {
        this.state.gameInProgress = true;
        
        // Show player selection based on role
        if (this.state.isBatting) {
          this.showBatterSelection();
        } else {
          this.showBowlerSelection();
        }
        
        this.elements.result.innerText = "Game ready! Select your players to begin.";
        this.updateButtonStates();
        
        // Update game state in Firebase
        this.updateGameState();
      }

      loadGameState(gameData) {
        // Load existing game state
        this.state.runs = gameData.runs || 0;
        this.state.wickets = gameData.wickets || 0;
        this.state.legalBalls = gameData.legalBalls || 0;
        this.state.totalBalls = gameData.totalBalls || 0;
        this.state.freeHit = gameData.freeHit || false;
        this.state.freeHitNextBall = gameData.freeHitNextBall || false;
        this.state.currentBatter1 = gameData.currentBatter1;
        this.state.currentBatter2 = gameData.currentBatter2;
        this.state.currentBowler = gameData.currentBowler;
        this.state.nextBatterIndex = gameData.nextBatterIndex || 0;
        this.state.batterStats = gameData.batterStats || {};
        this.state.bowlerStats = gameData.bowlerStats || {};
        this.state.partnership = gameData.partnership || { runs: 0, balls: 0 };
        this.state.fallOfWickets = gameData.fallOfWickets || [];
        this.state.ballByBall = gameData.ballByBall || [];
        this.state.currentOverBalls = gameData.currentOverBalls || [];
        
        this.state.gameInProgress = true;
        
        // Update UI
        this.updateAllDisplays();
        this.updateBallsDisplay();
        this.updateStatsDisplay();
        
        // Check if players need to be selected
        if (this.state.isBatting && !this.state.currentBatter1) {
          this.showBatterSelection();
        } else if (!this.state.isBatting && !this.state.currentBowler) {
          this.showBowlerSelection();
        } else {
          this.enableButtons();
        }
        
        this.elements.result.innerText = "Game resumed. Continue playing.";
      }

      showBatterSelection() {
        this.elements.batterSelection.style.display = 'block';
        this.elements.bowlerSelection.style.display = 'none';
        
        // Clear previous buttons
        this.elements.batterButtons.innerHTML = '';
        
        // Add available batters (not out)
        this.state.team1Players.forEach((player, index) => {
          if (!this.state.batterStats[player]?.out && 
              player !== this.state.currentBatter1 && 
              player !== this.state.currentBatter2) {
            const button = document.createElement('button');
            button.className = 'player-btn';
            button.textContent = player;
            button.addEventListener('click', () => this.selectBatter(player, index));
            this.elements.batterButtons.appendChild(button);
          }
        });
        
        this.disableButtons();
      }

      showBowlerSelection() {
        this.elements.batterSelection.style.display = 'none';
        this.elements.bowlerSelection.style.display = 'block';
        
        // Clear previous buttons
        this.elements.bowlerButtons.innerHTML = '';
        
        // Add available bowlers
        this.state.team2Players.forEach((player, index) => {
          const button = document.createElement('button');
          button.className = 'player-btn';
          button.textContent = player;
          button.addEventListener('click', () => this.selectBowler(player));
          this.elements.bowlerButtons.appendChild(button);
        });
        
        this.disableButtons();
      }

      selectBatter(player, index) {
        if (!this.state.currentBatter1) {
          this.state.currentBatter1 = player;
        } else if (!this.state.currentBatter2) {
          this.state.currentBatter2 = player;
        }
        
        this.state.nextBatterIndex = Math.max(this.state.nextBatterIndex, index + 1);
        this.state.batterSelected = true;
        
        this.elements.batterSelection.style.display = 'none';
        this.enableButtons();
        
        this.updateGameState();
        this.updateStatsDisplay();
        
        this.elements.result.innerText = `Batter selected: ${player}`;
        setTimeout(() => {
          this.elements.result.innerText = this.state.isBatting ? "Select your shot" : "Select your delivery";
        }, 2000);
      }

      selectBowler(player) {
        this.state.currentBowler = player;
        this.state.bowlerSelected = true;
        
        this.elements.bowlerSelection.style.display = 'none';
        this.enableButtons();
        
        this.updateGameState();
        this.updateStatsDisplay();
        
        this.elements.result.innerText = `Bowler selected: ${player}`;
        setTimeout(() => {
          this.elements.result.innerText = this.state.isBatting ? "Select your shot" : "Select your delivery";
        }, 2000);
      }

      setupCardButtons() {
        this.elements.buttons.forEach(btn => {
          btn.addEventListener("click", () => {
            if (btn.disabled || this.state.isProcessingSelection) return;
            
            const cardValue = parseInt(btn.dataset.value);
            this.state.selectedCardValue = cardValue;
            this.state.isProcessingSelection = true;

            this.disableButtons();
            this.highlightSelectedCard(cardValue);
            
            this.elements.result.innerText = `${this.state.isBatting ? 'Batting' : 'Bowling'} selection: ${cardValue}`;

            // Send selection to Firebase
            this.sendCardSelection(cardValue);
          });
        });
      }

      async sendCardSelection(cardValue) {
        try {
          // Update player's card selection in Firebase
          await update(ref(db, `rooms/${this.state.roomId}/${this.state.player}`), {
            card: cardValue,
            selectionTime: Date.now()
          });
          
          // Check for opponent's selection
          this.checkForBothSelections();
        } catch (error) {
          console.error("Error sending card selection:", error);
          this.elements.result.innerText = "Error sending selection. Please try again.";
          this.enableButtons();
          this.clearCardSelection();
        }
      }

      async checkForBothSelections() {
        try {
          const roomSnap = await get(this.roomRef);
          if (!roomSnap.exists()) return;
          
          const roomData = roomSnap.val();
          const player1Card = roomData.player1?.card;
          const player2Card = roomData.player2?.card;
          
          if (player1Card !== null && player2Card !== null) {
            // Both players have made their selections
            const batterCard = this.state.isBatting ? 
              (this.state.player === "player1" ? player1Card : player2Card) :
              (this.state.player === "player1" ? player2Card : player1Card);
              
            const bowlerCard = this.state.isBatting ? 
              (this.state.player === "player1" ? player2Card : player1Card) :
              (this.state.player === "player1" ? player1Card : player2Card);
            
            // Process the ball result
            this.processBallResult(batterCard, bowlerCard);
          } else {
            // Wait for opponent's selection
            setTimeout(() => this.checkForBothSelections(), 1000);
          }
        } catch (error) {
          console.error("Error checking selections:", error);
          this.elements.result.innerText = "Error checking opponent's selection.";
          this.enableButtons();
          this.clearCardSelection();
        }
      }

      processBallResult(batterCard, bowlerCard) {
        let outcome = "";
        let isLegalBall = false;
        let isWicket = false;
        let runsScored = 0;
        let isExtra = false;
        let isBoundary = false;
        
        // 1. Check for no ball (both 0)
        if (batterCard === 0 && bowlerCard === 0) {
          outcome = "NO BALL! +1 run (Free Hit next ball)";
          runsScored = 1;
          this.state.runs += runsScored;
          this.state.freeHitNextBall = true;
          isExtra = true;
          isLegalBall = false;
        } 
        // 2. Handle free hit balls
        else if (this.state.freeHit) {
          if (batterCard === bowlerCard && batterCard > 0) {
            outcome = "Wicket on Free Hit (not out)";
            isWicket = false;
            isLegalBall = true;
          } else {
            runsScored = batterCard;
            this.state.runs += runsScored;
            outcome = `${batterCard} Run(s)! (Free Hit)`;
            isLegalBall = true;
            isBoundary = (batterCard === 4 || batterCard === 6);
          }
          this.state.freeHit = false;
        }
        // 3. Handle wickets (same number > 0)
        else if (batterCard === bowlerCard && batterCard > 0) {
          const wicketValue = this.state.isPowerplay ? 
            this.state.formatRules.powerplayWicketValue : 
            this.state.formatRules.regularWicketValue;
            
          this.state.wickets += wicketValue;
          isWicket = true;
          outcome = `WICKET! (${wicketValue} wicket${wicketValue !== 1 ? 's' : ''})`;
          isLegalBall = true;
        }
        // 4. Normal runs
        else {
          runsScored = batterCard;
          this.state.runs += runsScored;
          outcome = `${batterCard} Run(s)!`;
          isLegalBall = true;
          isBoundary = (batterCard === 4 || batterCard === 6);
        }

        // Update batter stats
        if (isLegalBall && !isWicket && runsScored > 0) {
          if (Math.random() > 0.5) { // Randomly assign runs to one batter
            this.state.batterStats[this.state.currentBatter1].runs += runsScored;
            this.state.batterStats[this.state.currentBatter1].balls += 1;
            if (runsScored === 4) this.state.batterStats[this.state.currentBatter1].fours += 1;
            if (runsScored === 6) this.state.batterStats[this.state.currentBatter1].sixes += 1;
          } else {
            this.state.batterStats[this.state.currentBatter2].runs += runsScored;
            this.state.batterStats[this.state.currentBatter2].balls += 1;
            if (runsScored === 4) this.state.batterStats[this.state.currentBatter2].fours += 1;
            if (runsScored === 6) this.state.batterStats[this.state.currentBatter2].sixes += 1;
          }
          
          // Update partnership
          this.state.partnership.runs += runsScored;
          this.state.partnership.balls += 1;
        }

        // Update bowler stats
        if (this.state.currentBowler && isLegalBall) {
          this.state.bowlerStats[this.state.currentBowler].balls += 1;
          this.state.bowlerStats[this.state.currentBowler].runs += runsScored;
          
          if (isWicket) {
            this.state.bowlerStats[this.state.currentBowler].wickets += 1;
          }
        }

        // Record ball in current over
        this.state.currentOverBalls.push({
          runs: runsScored,
          wicket: isWicket,
          extra: isExtra,
          boundary: isBoundary,
          ballType: isExtra ? "No Ball" : "Legal"
        });

        // Record ball in ball-by-ball
        this.state.ballByBall.push({
          over: Math.floor(this.state.legalBalls / 6),
          ball: (this.state.legalBalls % 6) + 1,
          batter: Math.random() > 0.5 ? this.state.currentBatter1 : this.state.currentBatter2,
          bowler: this.state.currentBowler,
          runs: runsScored,
          wicket: isWicket,
          extra: isExtra,
          boundary: isBoundary,
          outcome: outcome,
          timestamp: Date.now()
        });

        if (isWicket) {
          this.state.fallOfWickets.push({
            wicket: this.state.wickets,
            runs: this.state.runs,
            batter: Math.random() > 0.5 ? this.state.currentBatter1 : this.state.currentBatter2,
            over: Math.floor(this.state.legalBalls / 6) + "." + ((this.state.legalBalls % 6) + 1)
          });
          
          // Mark batter as out
          if (Math.random() > 0.5) {
            this.state.batterStats[this.state.currentBatter1].out = true;
            this.state.currentBatter1 = null;
          } else {
            this.state.batterStats[this.state.currentBatter2].out = true;
            this.state.currentBatter2 = null;
          }
          
          // Reset partnership
          this.state.partnership = { runs: 0, balls: 0 };
        }

        if (isLegalBall) {
          this.state.legalBalls++;
        }
        
        this.state.totalBalls++;

        // Check for over completion
        const ballsInOver = this.state.legalBalls % 6;
        if (ballsInOver === 0 && this.state.legalBalls > 0) {
          // Over completed
          outcome += " Over completed!";
          
          // Check for maiden over
          const overRuns = this.state.currentOverBalls.reduce((sum, ball) => sum + ball.runs, 0);
          if (overRuns === 0 && !isExtra) {
            this.state.bowlerStats[this.state.currentBowler].maidens += 1;
          }
          
          // Reset current over
          this.state.currentOverBalls = [];
          
          // Reset free hit for new over
          this.state.freeHitNextBall = false;
        }
        
        // Set free hit for next ball if applicable
        if (this.state.freeHitNextBall) {
          this.state.freeHit = true;
          this.state.freeHitNextBall = false;
        }

        this.updateAllDisplays();
        this.updateBallsDisplay();
        this.updateStatsDisplay();
        
        this.elements.result.innerText = outcome;
        
        // Check for innings end conditions
        if (this.checkInningsEnd()) {
          this.endInnings();
          return;
        }
        
        // Reset for next ball
        setTimeout(() => {
          this.resetSelections();
          this.enableButtons();
          this.clearCardSelection();
          
          // If wicket fell, show batter selection
          if (isWicket && (this.state.currentBatter1 === null || this.state.currentBatter2 === null)) {
            this.showBatterSelection();
          } else {
            this.elements.result.innerText = "Next ball...";
          }
        }, 3000);
        
        // Update game state in Firebase
        this.updateGameState();
      }

      checkInningsEnd() {
        const completedOvers = Math.floor(this.state.legalBalls / 6);
        const remainingBalls = 6 - (this.state.legalBalls % 6);
        
        // Check if all overs are completed
        if (completedOvers >= this.state.formatRules.totalOvers) {
          return true;
        }
        
        // Check if all wickets are taken
        if (this.state.wickets >= this.state.formatRules.totalWickets) {
          return true;
        }
        
        return false;
      }

      endInnings() {
        this.state.gameInProgress = false;
        this.disableButtons();
        
        // Calculate target for second innings
        const target = this.state.runs + 1;
        
        // Show innings summary modal
        this.showInningsSummary(target);
        
        // Update game state in Firebase
        this.updateGameState();
      }

      showInningsSummary(target) {
        this.elements.inningsSummaryText.textContent = 
          `${this.elements.battingTeamName.textContent} scored ${this.state.runs}/${this.state.wickets} in ${Math.floor(this.state.legalBalls/6)}.${this.state.legalBalls%6} overs (Run Rate: ${(this.state.runs/(this.state.legalBalls/6)).toFixed(2)})`;
        
        // Populate batting stats
        this.elements.battingStatsBody.innerHTML = '';
        this.state.team1Players.forEach(player => {
          const stats = this.state.batterStats[player];
          if (stats) {
            const row = document.createElement('tr');
            const sr = stats.balls > 0 ? (stats.runs / stats.balls * 100).toFixed(2) : '0.00';
            
            row.innerHTML = `
              <td>${player} ${stats.out ? '(out)' : ''}</td>
              <td>${stats.runs}</td>
              <td>${stats.balls}</td>
              <td>${stats.fours}</td>
              <td>${stats.sixes}</td>
              <td>${sr}</td>
            `;
            
            if (stats.runs >= 50) {
              row.classList.add('highlight');
            }
            
            this.elements.battingStatsBody.appendChild(row);
          }
        });
        
        // Populate bowling stats
        this.elements.bowlingStatsBody.innerHTML = '';
        this.state.team2Players.forEach(player => {
          const stats = this.state.bowlerStats[player];
          if (stats && stats.balls > 0) {
            const overs = Math.floor(stats.balls / 6) + '.' + (stats.balls % 6);
            const economy = (stats.runs / (stats.balls / 6)).toFixed(2);
            
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${player}</td>
              <td>${overs}</td>
              <td>${stats.runs}</td>
              <td>${stats.wickets}</td>
              <td>${economy}</td>
            `;
            
            if (stats.wickets >= 3) {
              row.classList.add('highlight');
            }
            
            this.elements.bowlingStatsBody.appendChild(row);
          }
        });
        
        // Add highlights
        this.elements.inningsHighlights.innerHTML = '';
        const highlights = [];
        
        // Highest scorer
        const batters = Object.entries(this.state.batterStats)
          .filter(([_, stats]) => stats.runs > 0)
          .sort((a, b) => b[1].runs - a[1].runs);
        
        if (batters.length > 0) {
          highlights.push(`Top scorer: ${batters[0][0]} (${batters[0][1].runs} runs)`);
        }
        
        // Best bowler
        const bowlers = Object.entries(this.state.bowlerStats)
          .filter(([_, stats]) => stats.wickets > 0)
          .sort((a, b) => b[1].wickets - a[1].wickets || a[1].runs - b[1].runs);
        
        if (bowlers.length > 0) {
          highlights.push(`Best bowler: ${bowlers[0][0]} (${bowlers[0][1].wickets}/${bowlers[0][1].runs})`);
        }
        
        // Biggest partnership
        if (this.state.partnership.runs > 0) {
          highlights.push(`Biggest partnership: ${this.state.partnership.runs} runs`);
        }
        
        if (highlights.length > 0) {
          const highlightsList = document.createElement('ul');
          highlightsList.style.marginTop = '10px';
          highlightsList.style.paddingLeft = '20px';
          highlightsList.style.textAlign = 'left';
          
          highlights.forEach(highlight => {
            const li = document.createElement('li');
            li.textContent = highlight;
            highlightsList.appendChild(li);
          });
          
          this.elements.inningsHighlights.appendChild(highlightsList);
        }
        
        // Show modal
        this.elements.inningsSummaryModal.style.display = 'flex';
        
        // Set up button to start second innings
        this.elements.startSecondInningsBtn.onclick = () => {
          // For now, just close the modal and show a message
          this.elements.inningsSummaryModal.style.display = 'none';
          this.elements.result.innerText = "First innings completed. Second innings would start here.";
          
          // In a real implementation, you would:
          // 1. Switch batting and bowling teams
          // 2. Reset score but keep target
          // 3. Start the second innings
        };
      }

      updateAllDisplays() {
        this.updateScoreboard();
        this.updateStatusBadges();
        this.updateOverProgress();
      }

      updateScoreboard() {
        this.elements.runs.textContent = this.state.runs;
        this.elements.wickets.textContent = Math.floor(this.state.wickets);
        
        const completedOvers = Math.floor(this.state.legalBalls / 6);
        const currentBall = this.state.legalBalls % 6;
        this.elements.overs.textContent = `${completedOvers}.${currentBall}`;
        
        const rr = completedOvers > 0 ? (this.state.runs / completedOvers).toFixed(2) : '0.00';
        this.elements.runRate.textContent = rr;
        
        // Update team scores
        if (this.state.battingFirst === "player1") {
          this.elements.team1Score.textContent = `${this.state.runs}/${this.state.wickets} (${completedOvers}.${currentBall})`;
          this.elements.team2Score.textContent = "Yet to bat";
        } else {
          this.elements.team1Score.textContent = "Yet to bat";
          this.elements.team2Score.textContent = `${this.state.runs}/${this.state.wickets} (${completedOvers}.${currentBall})`;
        }
      }

      updateStatusBadges() {
        const completedOvers = Math.floor(this.state.legalBalls / 6);
        const currentOver = completedOvers + 1;
        
        // Check powerplay
        this.state.isPowerplay = false;
        if (Array.isArray(this.state.formatRules.powerplayOvers)) {
          for (let i = 0; i < this.state.formatRules.powerplayOvers.length; i += 2) {
            if (currentOver >= this.state.formatRules.powerplayOvers[i] && 
                currentOver <= this.state.formatRules.powerplayOvers[i+1]) {
              this.state.isPowerplay = true;
              break;
            }
          }
        } else if (currentOver <= this.state.formatRules.powerplayOvers) {
          this.state.isPowerplay = true;
        }
        
        // Check dead over (ODI specific)
        this.state.isDeadOver = false;
        if (this.state.format === "50" && Array.isArray(this.state.formatRules.deadOvers)) {
          for (let i = 0; i < this.state.formatRules.deadOvers.length; i += 2) {
            if (currentOver >= this.state.formatRules.deadOvers[i] && 
                currentOver <= this.state.formatRules.deadOvers[i+1]) {
              this.state.isDeadOver = true;
              break;
            }
          }
        }
        
        // Update badge visibility
        this.elements.powerplayBadge.style.display = this.state.isPowerplay ? 'inline-block' : 'none';
        this.elements.deadOverBadge.style.display = this.state.isDeadOver ? 'inline-block' : 'none';
        this.elements.freeHitBadge.style.display = this.state.freeHit ? 'inline-block' : 'none';
      }

      updateOverProgress() {
        const ballsInOver = this.state.legalBalls % 6;
        const progress = (ballsInOver / 6) * 100;
        this.elements.overProgressBar.style.width = `${progress}%`;
      }

      updateBallsDisplay() {
        this.elements.ballsContainer.innerHTML = '';
        
        for (let i = 0; i < 6; i++) {
          const ball = document.createElement('div');
          ball.className = 'ball';
          
          if (i < this.state.currentOverBalls.length) {
            const ballData = this.state.currentOverBalls[i];
            
            if (ballData.wicket) {
              ball.className += ' wicket';
              ball.textContent = 'W';
            } else if (ballData.extra) {
              ball.className += ' extras';
              ball.textContent = ballData.runs > 0 ? ballData.runs : 'NB';
            } else if (ballData.runs > 0) {
              ball.className += ' runs';
              ball.textContent = ballData.runs;
            } else {
              ball.className += ' dot';
              ball.textContent = '';
            }
          } else {
            ball.textContent = '';
          }
          
          this.elements.ballsContainer.appendChild(ball);
        }
      }

      updateStatsDisplay() {
        if (this.state.currentBatter1 && this.state.currentBatter2) {
          this.elements.statsSection.style.display = 'block';
          
          this.elements.batter1Name.textContent = this.state.currentBatter1;
          this.elements.batter1Runs.textContent = this.state.batterStats[this.state.currentBatter1]?.runs || 0;
          
          this.elements.batter2Name.textContent = this.state.currentBatter2;
          this.elements.batter2Runs.textContent = this.state.batterStats[this.state.currentBatter2]?.runs || 0;
          
          this.elements.partnershipRuns.textContent = this.state.partnership.runs;
          this.elements.partnershipBalls.textContent = this.state.partnership.balls;
          
          if (this.state.currentBowler) {
            this.elements.currentBowler.textContent = this.state.currentBowler;
            const balls = this.state.bowlerStats[this.state.currentBowler]?.balls || 0;
            const overs = Math.floor(balls / 6) + '.' + (balls % 6);
            this.elements.bowlerOvers.textContent = overs;
          }
        } else {
          this.elements.statsSection.style.display = 'none';
        }
      }

      updateButtonStates() {
        const canPlay = this.state.gameInProgress && 
          ((this.state.isBatting && this.state.currentBatter1 && this.state.currentBatter2) || 
           (!this.state.isBatting && this.state.currentBowler));
        
        this.elements.buttons.forEach(btn => {
          btn.disabled = !canPlay;
        });
        
        if (canPlay) {
          this.elements.result.innerText = this.state.isBatting ? "Select your shot" : "Select your delivery";
        }
      }

      disableButtons() {
        this.elements.buttons.forEach(btn => {
          btn.disabled = true;
        });
      }

      enableButtons() {
        this.updateButtonStates();
      }

      clearCardSelection() {
        this.elements.buttons.forEach(btn => {
          btn.classList.remove("selected");
        });
        this.state.selectedCardValue = null;
        this.state.isProcessingSelection = false;
      }

      highlightSelectedCard(value) {
        this.elements.buttons.forEach(btn => {
          const val = parseInt(btn.dataset.value);
          btn.classList.toggle("selected", val === value);
        });
      }

      async resetSelections() {
        try {
          // Reset card selections in Firebase
          await update(ref(db, `rooms/${this.state.roomId}/${this.state.player}`), {
            card: null
          });
        } catch (error) {
          console.error("Error resetting selections:", error);
        }
      }

      async updateGameState() {
        try {
          await update(ref(db, `rooms/${this.state.roomId}/game`), this.state);
        } catch (error) {
          console.error("Error updating game state:", error);
        }
      }

      monitorOpponentConnection() {
        onValue(this.opponentRef, (snap) => {
          if (snap.exists() && snap.val().connected) {
            this.elements.connectionStatus.textContent = "Opponent: Online";
            this.elements.connectionStatus.className = "connection-status online";
          } else {
            this.elements.connectionStatus.textContent = "Opponent: Offline";
            this.elements.connectionStatus.className = "connection-status offline";
          }
        });
      }
    }

    // Initialize the game when page loads
    document.addEventListener('DOMContentLoaded', () => {
      const game = new CricketGame();
      
      // Make game available globally for debugging
      window.game = game;
    });
  </script>
</body>
</html>