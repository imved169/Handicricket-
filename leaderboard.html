<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HandiCricket - Leaderboard</title>
  <style>
    body {
      background: linear-gradient(135deg, #061e3e, #0a2a4a);
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    h1 {
      color: #ffeb3b;
      text-shadow: 0 0 10px rgba(255, 235, 59, 0.5);
      margin-bottom: 20px;
      text-align: center;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
      font-size: 14px;
    }
    
    .tab.active {
      border-bottom: 3px solid #1e88e5;
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 14px;
    }
    
    .leaderboard-table th {
      background: rgba(30, 136, 229, 0.5);
      padding: 10px;
      text-align: left;
      position: sticky;
      top: 0;
    }
    
    .leaderboard-table td {
      padding: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .leaderboard-table tr:nth-child(even) {
      background: rgba(13, 42, 82, 0.3);
    }
    
    .leaderboard-table tr:hover {
      background: rgba(30, 136, 229, 0.2);
    }
    
    .rank {
      font-weight: bold;
      color: #ffeb3b;
      text-align: center;
    }
    
    .player-name {
      font-weight: bold;
    }
    
    .team-name {
      color: #aaa;
      font-size: 12px;
    }
    
    .highlight {
      background: rgba(255, 235, 59, 0.2);
    }
    
    .medal-gold {
      color: gold;
    }
    
    .medal-silver {
      color: silver;
    }
    
    .medal-bronze {
      color: #cd7f32;
    }
    
    .format-filter {
      margin: 15px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .format-btn {
      padding: 8px 15px;
      border-radius: 20px;
      border: none;
      background: rgba(30, 136, 229, 0.3);
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .format-btn.active {
      background: #1e88e5;
    }
    
    .stats-card {
      background: rgba(13, 42, 82, 0.5);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .stats-card h3 {
      margin-top: 0;
      color: #ffeb3b;
      border-bottom: 2px solid #1e88e5;
      padding-bottom: 8px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(30, 136, 229, 0.2);
      border-radius: 8px;
      padding: 10px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #ffeb3b;
    }
    
    .stat-label {
      font-size: 12px;
      color: #aaa;
    }
    
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid #1e88e5;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    .back-btn {
      display: inline-block;
      padding: 10px 20px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: none;
      background: linear-gradient(145deg, #607D8B, #455A64);
      color: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      text-decoration: none;
    }
    
    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .leaderboard-table {
        font-size: 12px;
      }
      
      .leaderboard-table th, 
      .leaderboard-table td {
        padding: 8px 5px;
      }
      
      .tab {
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-btn">
      <i class="fas fa-arrow-left"></i> Back to Home
    </a>
    
    <h1><i class="fas fa-trophy"></i> HandiCricket Leaderboard</h1>
    
    <div class="tabs">
      <div class="tab active" data-tab="players">Player Rankings</div>
      <div class="tab" data-tab="teams">Team Rankings</div>
      <div class="tab" data-tab="batters">Top Batters</div>
      <div class="tab" data-tab="bowlers">Top Bowlers</div>
      <div class="tab" data-tab="allrounders">All-Rounders</div>
      <div class="tab" data-tab="milestones">Milestones</div>
    </div>
    
    <div class="format-filter">
      <button class="format-btn active" data-format="all">All Formats</button>
      <button class="format-btn" data-format="5">T5</button>
      <button class="format-btn" data-format="10">T10</button>
      <button class="format-btn" data-format="20">T20</button>
      <button class="format-btn" data-format="50">ODI</button>
    </div>
    
    <!-- Player Rankings -->
    <div class="tab-content active" id="players-tab">
      <div class="stats-card">
        <h3>Top Players</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="topPlayerRuns">-</div>
            <div class="stat-label">Most Runs (Career)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topPlayerWickets">-</div>
            <div class="stat-label">Most Wickets (Career)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topPlayerMatches">-</div>
            <div class="stat-label">Most Matches Played</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topPlayerWins">-</div>
            <div class="stat-label">Most Wins</div>
          </div>
        </div>
      </div>
      
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th width="50">Rank</th>
            <th>Player</th>
            <th>Team</th>
            <th>Matches</th>
            <th>Runs</th>
            <th>Wickets</th>
            <th>Bat Avg</th>
            <th>Bowl Avg</th>
            <th>Win %</th>
          </tr>
        </thead>
        <tbody id="playerRankingsBody">
          <tr>
            <td colspan="9" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading player rankings...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Team Rankings -->
    <div class="tab-content" id="teams-tab">
      <div class="stats-card">
        <h3>Team Statistics</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="topTeamWins">-</div>
            <div class="stat-label">Most Wins</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topTeamRuns">-</div>
            <div class="stat-label">Highest Team Total</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topTeamChases">-</div>
            <div class="stat-label">Most Successful Chases</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topTeamDefends">-</div>
            <div class="stat-label">Most Successful Defends</div>
          </div>
        </div>
      </div>
      
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th width="50">Rank</th>
            <th>Team</th>
            <th>Matches</th>
            <th>Wins</th>
            <th>Losses</th>
            <th>Win %</th>
            <th>Highest Score</th>
            <th>Lowest Score</th>
          </tr>
        </thead>
        <tbody id="teamRankingsBody">
          <tr>
            <td colspan="8" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading team rankings...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Top Batters -->
    <div class="tab-content" id="batters-tab">
      <div class="stats-card">
        <h3>Batting Records</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="topBatterRuns">-</div>
            <div class="stat-label">Most Runs in an Innings</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topBatterAvg">-</div>
            <div class="stat-label">Highest Batting Average</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topBatterSR">-</div>
            <div class="stat-label">Highest Strike Rate</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topBatterBoundaries">-</div>
            <div class="stat-label">Most Boundaries</div>
          </div>
        </div>
      </div>
      
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th width="50">Rank</th>
            <th>Batter</th>
            <th>Team</th>
            <th>Innings</th>
            <th>Runs</th>
            <th>Avg</th>
            <th>SR</th>
            <th>50s</th>
            <th>100s</th>
            <th>4s/6s</th>
          </tr>
        </thead>
        <tbody id="batterRankingsBody">
          <tr>
            <td colspan="10" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading batting rankings...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Top Bowlers -->
    <div class="tab-content" id="bowlers-tab">
      <div class="stats-card">
        <h3>Bowling Records</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="topBowlerWickets">-</div>
            <div class="stat-label">Most Wickets in a Match</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topBowlerAvg">-</div>
            <div class="stat-label">Best Bowling Average</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topBowlerER">-</div>
            <div class="stat-label">Best Economy Rate</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topBowlerSR">-</div>
            <div class="stat-label">Best Strike Rate</div>
          </div>
        </div>
      </div>
      
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th width="50">Rank</th>
            <th>Bowler</th>
            <th>Team</th>
            <th>Innings</th>
            <th>Wickets</th>
            <th>Avg</th>
            <th>ER</th>
            <th>SR</th>
            <th>5W</th>
            <th>Best</th>
          </tr>
        </thead>
        <tbody id="bowlerRankingsBody">
          <tr>
            <td colspan="10" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading bowling rankings...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- All-Rounders -->
    <div class="tab-content" id="allrounders-tab">
      <div class="stats-card">
        <h3>All-Round Performance</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="topAllrounderRunsWickets">-</div>
            <div class="stat-label">Most Runs + Wickets</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topAllrounderMatches">-</div>
            <div class="stat-label">Most Player of Match Awards</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="topAllrounderDouble">-</div>
            <div class="stat-label">Most 50+ Runs & 3+ Wickets</div>
          </div>
        </div>
      </div>
      
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th width="50">Rank</th>
            <th>Player</th>
            <th>Team</th>
            <th>Runs</th>
            <th>Wickets</th>
            <th>Bat Avg</th>
            <th>Bowl Avg</th>
            <th>POM</th>
            <th>50+ & 3+</th>
          </tr>
        </thead>
        <tbody id="allrounderRankingsBody">
          <tr>
            <td colspan="8" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading all-rounder rankings...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Milestones -->
    <div class="tab-content" id="milestones-tab">
      <div class="stats-card">
        <h3>Milestones Achieved</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="totalCenturies">-</div>
            <div class="stat-label">Total Centuries</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="totalHalfCenturies">-</div>
            <div class="stat-label">Total Half-Centuries</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="totalFiveWickets">-</div>
            <div class="stat-label">5-Wicket Hauls</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="totalHatTricks">-</div>
            <div class="stat-label">Hat-Tricks</div>
          </div>
        </div>
      </div>
      
      <h3>Recent Centuries</h3>
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th>Player</th>
            <th>Team</th>
            <th>Runs</th>
            <th>Balls</th>
            <th>4s/6s</th>
            <th>Match</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="centuriesBody">
          <tr>
            <td colspan="7" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading centuries...
            </td>
          </tr>
        </tbody>
      </table>
      
      <h3>Recent 5-Wicket Hauls</h3>
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th>Bowler</th>
            <th>Team</th>
            <th>Wickets</th>
            <th>Runs</th>
            <th>Overs</th>
            <th>Match</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="fiveWicketsBody">
          <tr>
            <td colspan="7" style="text-align: center;">
              <div class="loading-spinner"></div>
              Loading 5-wicket hauls...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, get, query, orderByChild, equalTo, limitToLast } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCN6aZMwlsZe7JJaovU0WA3UQygWr4jYmA",
      authDomain: "handicricket-85a06.firebaseapp.com",
      projectId: "handicricket-85a06",
      storageBucket: "handicricket-85a06.appspot.com",
      messagingSenderId: "599182538558",
      appId: "1:599182538558:web:3e965753ab05f8f1e3de6f",
      measurementId: "G-HSV9H4LEJQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        
        // Load data for the tab if not already loaded
        if (tab.dataset.tab === 'players') loadPlayerRankings();
        if (tab.dataset.tab === 'teams') loadTeamRankings();
        if (tab.dataset.tab === 'batters') loadBatterRankings();
        if (tab.dataset.tab === 'bowlers') loadBowlerRankings();
        if (tab.dataset.tab === 'allrounders') loadAllrounderRankings();
        if (tab.dataset.tab === 'milestones') loadMilestones();
      });
    });
    
    // Format filtering
    let currentFormat = 'all';
    document.querySelectorAll('.format-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFormat = btn.dataset.format;
        
        // Reload current tab with new format filter
        const activeTab = document.querySelector('.tab.active');
        if (activeTab.dataset.tab === 'players') loadPlayerRankings();
        if (activeTab.dataset.tab === 'teams') loadTeamRankings();
        if (activeTab.dataset.tab === 'batters') loadBatterRankings();
        if (activeTab.dataset.tab === 'bowlers') loadBowlerRankings();
        if (activeTab.dataset.tab === 'allrounders') loadAllrounderRankings();
        if (activeTab.dataset.tab === 'milestones') loadMilestones();
      });
    });

    // Load player rankings
    async function loadPlayerRankings() {
      try {
        // Get all completed matches
        const matchesRef = ref(db, 'completedMatches');
        const matchesSnap = await get(matchesRef);
        
        if (!matchesSnap.exists()) {
          document.getElementById('playerRankingsBody').innerHTML = `
            <tr>
              <td colspan="9" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          return;
        }
        
        const matches = Object.values(matchesSnap.val());
        
        // Filter by format if needed
        const filteredMatches = currentFormat === 'all' 
          ? matches 
          : matches.filter(m => m.format === formatName(currentFormat));
        
        // Process player stats
        const playerStats = {};
        
        filteredMatches.forEach(match => {
          // Process player1 team
          if (match.player1Stats) {
            Object.entries(match.player1Stats).forEach(([player, stats]) => {
              if (!playerStats[player]) {
                playerStats[player] = initPlayerStats(player, match.player1.team);
              }
              updatePlayerStats(playerStats[player], stats, match.winner === 'player1');
            });
          }
          
          // Process player2 team
          if (match.player2Stats) {
            Object.entries(match.player2Stats).forEach(([player, stats]) => {
              if (!playerStats[player]) {
                playerStats[player] = initPlayerStats(player, match.player2.team);
              }
              updatePlayerStats(playerStats[player], stats, match.winner === 'player2');
            });
          }
        });
        
        // Convert to array and sort by runs + wickets
        const playersArray = Object.values(playerStats).sort((a, b) => {
          return (b.runs + (b.wickets * 25)) - (a.runs + (a.wickets * 25));
        });
        
        // Update top stats
        if (playersArray.length > 0) {
          document.getElementById('topPlayerRuns').textContent = `${playersArray[0].runs} (${playersArray[0].name})`;
          document.getElementById('topPlayerWickets').textContent = `${playersArray[0].wickets} (${playersArray[0].name})`;
          
          // Find player with most matches
          const mostMatchesPlayer = [...playersArray].sort((a, b) => b.matches - a.matches)[0];
          document.getElementById('topPlayerMatches').textContent = `${mostMatchesPlayer.matches} (${mostMatchesPlayer.name})`;
          
          // Find player with most wins
          const mostWinsPlayer = [...playersArray].sort((a, b) => b.wins - a.wins)[0];
          document.getElementById('topPlayerWins').textContent = `${mostWinsPlayer.wins} (${mostWinsPlayer.name})`;
        }
        
        // Update table
        const tbody = document.getElementById('playerRankingsBody');
        tbody.innerHTML = '';
        
        playersArray.forEach((player, index) => {
          const tr = document.createElement('tr');
          if (index < 3) tr.classList.add('highlight');
          
          const batAvg = player.batInnings > 0 ? (player.runs / player.batInnings).toFixed(2) : '-';
          const bowlAvg = player.wickets > 0 ? (player.runsConceded / player.wickets).toFixed(2) : '-';
          const winPct = player.matches > 0 ? ((player.wins / player.matches) * 100).toFixed(1) : '-';
          
          tr.innerHTML = `
            <td class="rank">
              ${index + 1}
              ${index === 0 ? '<span class="medal-gold"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 1 ? '<span class="medal-silver"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 2 ? '<span class="medal-bronze"><i class="fas fa-medal"></i></span>' : ''}
            </td>
            <td class="player-name">${player.name}</td>
            <td class="team-name">${player.team}</td>
            <td>${player.matches}</td>
            <td>${player.runs}</td>
            <td>${player.wickets}</td>
            <td>${batAvg}</td>
            <td>${bowlAvg}</td>
            <td>${winPct}%</td>
          `;
          
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading player rankings:", error);
        document.getElementById('playerRankingsBody').innerHTML = `
          <tr>
            <td colspan="9" style="text-align: center; color: #f44336;">Error loading player rankings</td>
          </tr>
        `;
      }
    }
    
    // Load team rankings
    async function loadTeamRankings() {
      try {
        // Get all completed matches
        const matchesRef = ref(db, 'completedMatches');
        const matchesSnap = await get(matchesRef);
        
        if (!matchesSnap.exists()) {
          document.getElementById('teamRankingsBody').innerHTML = `
            <tr>
              <td colspan="8" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          return;
        }
        
        const matches = Object.values(matchesSnap.val());
        
        // Filter by format if needed
        const filteredMatches = currentFormat === 'all' 
          ? matches 
          : matches.filter(m => m.format === formatName(currentFormat));
        
        // Process team stats
        const teamStats = {};
        
        filteredMatches.forEach(match => {
          // Process player1 team
          const team1 = match.player1.team;
          if (!teamStats[team1]) {
            teamStats[team1] = initTeamStats(team1);
          }
          updateTeamStats(teamStats[team1], match, match.winner === 'player1');
          
          // Process player2 team
          const team2 = match.player2.team;
          if (!teamStats[team2]) {
            teamStats[team2] = initTeamStats(team2);
          }
          updateTeamStats(teamStats[team2], match, match.winner === 'player2');
        });
        
        // Convert to array and sort by wins
        const teamsArray = Object.values(teamStats).sort((a, b) => {
          return b.wins - a.wins || b.matches - a.matches;
        });
        
        // Update top stats
        if (teamsArray.length > 0) {
          document.getElementById('topTeamWins').textContent = `${teamsArray[0].wins} (${teamsArray[0].name})`;
          
          // Find team with highest score
          const highestScoreTeam = [...teamsArray].sort((a, b) => b.highestScore - a.highestScore)[0];
          document.getElementById('topTeamRuns').textContent = `${highestScoreTeam.highestScore} (${highestScoreTeam.name})`;
          
          // Find team with most chases
          const mostChasesTeam = [...teamsArray].sort((a, b) => b.chases - a.chases)[0];
          document.getElementById('topTeamChases').textContent = `${mostChasesTeam.chases} (${mostChasesTeam.name})`;
          
          // Find team with most defends
          const mostDefendsTeam = [...teamsArray].sort((a, b) => b.defends - a.defends)[0];
          document.getElementById('topTeamDefends').textContent = `${mostDefendsTeam.defends} (${mostDefendsTeam.name})`;
        }
        
        // Update table
        const tbody = document.getElementById('teamRankingsBody');
        tbody.innerHTML = '';
        
        teamsArray.forEach((team, index) => {
          const tr = document.createElement('tr');
          if (index < 3) tr.classList.add('highlight');
          
          const winPct = team.matches > 0 ? ((team.wins / team.matches) * 100).toFixed(1) : '-';
          
          tr.innerHTML = `
            <td class="rank">
              ${index + 1}
              ${index === 0 ? '<span class="medal-gold"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 1 ? '<span class="medal-silver"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 2 ? '<span class="medal-bronze"><i class="fas fa-medal"></i></span>' : ''}
            </td>
            <td class="player-name">${team.name}</td>
            <td>${team.matches}</td>
            <td>${team.wins}</td>
            <td>${team.losses}</td>
            <td>${winPct}%</td>
            <td>${team.highestScore}</td>
            <td>${team.lowestScore}</td>
          `;
          
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading team rankings:", error);
        document.getElementById('teamRankingsBody').innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; color: #f44336;">Error loading team rankings</td>
          </tr>
        `;
      }
    }
    
    // Load batter rankings
    async function loadBatterRankings() {
      try {
        // Get all completed matches
        const matchesRef = ref(db, 'completedMatches');
        const matchesSnap = await get(matchesRef);
        
        if (!matchesSnap.exists()) {
          document.getElementById('batterRankingsBody').innerHTML = `
            <tr>
              <td colspan="10" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          return;
        }
        
        const matches = Object.values(matchesSnap.val());
        
        // Filter by format if needed
        const filteredMatches = currentFormat === 'all' 
          ? matches 
          : matches.filter(m => m.format === formatName(currentFormat));
        
        // Process batter stats
        const batterStats = {};
        
        filteredMatches.forEach(match => {
          // Process player1 team batters
          if (match.player1Stats) {
            Object.entries(match.player1Stats).forEach(([player, stats]) => {
              if (!batterStats[player]) {
                batterStats[player] = initBatterStats(player, match.player1.team);
              }
              updateBatterStats(batterStats[player], stats);
            });
          }
          
          // Process player2 team batters
          if (match.player2Stats) {
            Object.entries(match.player2Stats).forEach(([player, stats]) => {
              if (!batterStats[player]) {
                batterStats[player] = initBatterStats(player, match.player2.team);
              }
              updateBatterStats(batterStats[player], stats);
            });
          }
        });
        
        // Convert to array and sort by runs
        const battersArray = Object.values(batterStats).filter(b => b.innings > 0).sort((a, b) => {
          return b.runs - a.runs;
        });
        
        // Update top stats
        if (battersArray.length > 0) {
          // Highest score in an innings
          const highestScore = Math.max(...battersArray.map(b => b.highestScore));
          const highestScorer = battersArray.find(b => b.highestScore === highestScore);
          document.getElementById('topBatterRuns').textContent = `${highestScore} (${highestScorer.name})`;
          
          // Highest average (min 5 innings)
          const qualifiedBatters = battersArray.filter(b => b.innings >= 5);
          if (qualifiedBatters.length > 0) {
            const highestAvgBatter = [...qualifiedBatters].sort((a, b) => b.average - a.average)[0];
            document.getElementById('topBatterAvg').textContent = `${highestAvgBatter.average.toFixed(2)} (${highestAvgBatter.name})`;
          }
          
          // Highest strike rate (min 100 runs)
          const qualifiedSRBatters = battersArray.filter(b => b.runs >= 100);
          if (qualifiedSRBatters.length > 0) {
            const highestSRBatter = [...qualifiedSRBatters].sort((a, b) => b.strikeRate - b.strikeRate)[0];
            document.getElementById('topBatterSR').textContent = `${highestSRBatter.strikeRate.toFixed(2)} (${highestSRBatter.name})`;
          }
          
          // Most boundaries
          const mostBoundariesBatter = [...battersArray].sort((a, b) => (b.fours + b.sixes) - (a.fours + a.sixes))[0];
          document.getElementById('topBatterBoundaries').textContent = `${mostBoundariesBatter.fours + mostBoundariesBatter.sixes} (${mostBoundariesBatter.name})`;
        }
        
        // Update table
        const tbody = document.getElementById('batterRankingsBody');
        tbody.innerHTML = '';
        
        battersArray.forEach((batter, index) => {
          const tr = document.createElement('tr');
          if (index < 3) tr.classList.add('highlight');
          
          const avg = batter.innings > 0 ? (batter.runs / batter.innings).toFixed(2) : '-';
          const sr = batter.balls > 0 ? ((batter.runs / batter.balls) * 100).toFixed(2) : '-';
          
          tr.innerHTML = `
            <td class="rank">
              ${index + 1}
              ${index === 0 ? '<span class="medal-gold"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 1 ? '<span class="medal-silver"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 2 ? '<span class="medal-bronze"><i class="fas fa-medal"></i></span>' : ''}
            </td>
            <td class="player-name">${batter.name}</td>
            <td class="team-name">${batter.team}</td>
            <td>${batter.innings}</td>
            <td>${batter.runs}</td>
            <td>${avg}</td>
            <td>${sr}</td>
            <td>${batter.fifties}</td>
            <td>${batter.hundreds}</td>
            <td>${batter.fours}/${batter.sixes}</td>
          `;
          
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading batter rankings:", error);
        document.getElementById('batterRankingsBody').innerHTML = `
          <tr>
            <td colspan="10" style="text-align: center; color: #f44336;">Error loading batting rankings</td>
          </tr>
        `;
      }
    }
    
    // Load bowler rankings
    async function loadBowlerRankings() {
      try {
        // Get all completed matches
        const matchesRef = ref(db, 'completedMatches');
        const matchesSnap = await get(matchesRef);
        
        if (!matchesSnap.exists()) {
          document.getElementById('bowlerRankingsBody').innerHTML = `
            <tr>
              <td colspan="10" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          return;
        }
        
        const matches = Object.values(matchesSnap.val());
        
        // Filter by format if needed
        const filteredMatches = currentFormat === 'all' 
          ? matches 
          : matches.filter(m => m.format === formatName(currentFormat));
        
        // Process bowler stats
        const bowlerStats = {};
        
        filteredMatches.forEach(match => {
          // Process player1 team bowlers
          if (match.player1Stats) {
            Object.entries(match.player1Stats).forEach(([player, stats]) => {
              if (!bowlerStats[player]) {
                bowlerStats[player] = initBowlerStats(player, match.player1.team);
              }
              updateBowlerStats(bowlerStats[player], stats);
            });
          }
          
          // Process player2 team bowlers
          if (match.player2Stats) {
            Object.entries(match.player2Stats).forEach(([player, stats]) => {
              if (!bowlerStats[player]) {
                bowlerStats[player] = initBowlerStats(player, match.player2.team);
              }
              updateBowlerStats(bowlerStats[player], stats);
            });
          }
        });
        
        // Convert to array and sort by wickets
        const bowlersArray = Object.values(bowlerStats).filter(b => b.innings > 0).sort((a, b) => {
          return b.wickets - a.wickets;
        });
        
        // Update top stats
        if (bowlersArray.length > 0) {
          // Most wickets in a match
          const bestBowling = Math.max(...bowlersArray.map(b => b.bestWickets));
          const bestBowler = bowlersArray.find(b => b.bestWickets === bestBowling);
          document.getElementById('topBowlerWickets').textContent = `${bestBowling}/${bestBowler.bestRuns} (${bestBowler.name})`;
          
          // Best average (min 5 wickets)
          const qualifiedBowlers = bowlersArray.filter(b => b.wickets >= 5);
          if (qualifiedBowlers.length > 0) {
            const bestAvgBowler = [...qualifiedBowlers].sort((a, b) => a.average - b.average)[0];
            document.getElementById('topBowlerAvg').textContent = `${bestAvgBowler.average.toFixed(2)} (${bestAvgBowler.name})`;
          }
          
          // Best economy rate (min 10 overs)
          const qualifiedERBowlers = bowlersArray.filter(b => b.overs >= 10);
          if (qualifiedERBowlers.length > 0) {
            const bestERBowler = [...qualifiedERBowlers].sort((a, b) => a.economy - b.economy)[0];
            document.getElementById('topBowlerER').textContent = `${bestERBowler.economy.toFixed(2)} (${bestERBowler.name})`;
          }
          
          // Best strike rate (min 5 wickets)
          if (qualifiedBowlers.length > 0) {
            const bestSRBowler = [...qualifiedBowlers].sort((a, b) => a.strikeRate - b.strikeRate)[0];
            document.getElementById('topBowlerSR').textContent = `${bestSRBowler.strikeRate.toFixed(2)} (${bestSRBowler.name})`;
          }
        }
        
        // Update table
        const tbody = document.getElementById('bowlerRankingsBody');
        tbody.innerHTML = '';
        
        bowlersArray.forEach((bowler, index) => {
          const tr = document.createElement('tr');
          if (index < 3) tr.classList.add('highlight');
          
          const avg = bowler.wickets > 0 ? (bowler.runsConceded / bowler.wickets).toFixed(2) : '-';
          const er = bowler.overs > 0 ? (bowler.runsConceded / bowler.overs).toFixed(2) : '-';
          const sr = bowler.wickets > 0 ? (bowler.balls / bowler.wickets).toFixed(2) : '-';
          const best = bowler.bestWickets > 0 ? `${bowler.bestWickets}/${bowler.bestRuns}` : '-';
          
          tr.innerHTML = `
            <td class="rank">
              ${index + 1}
              ${index === 0 ? '<span class="medal-gold"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 1 ? '<span class="medal-silver"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 2 ? '<span class="medal-bronze"><i class="fas fa-medal"></i></span>' : ''}
            </td>
            <td class="player-name">${bowler.name}</td>
            <td class="team-name">${bowler.team}</td>
            <td>${bowler.innings}</td>
            <td>${bowler.wickets}</td>
            <td>${avg}</td>
            <td>${er}</td>
            <td>${sr}</td>
            <td>${bowler.fiveWickets}</td>
            <td>${best}</td>
          `;
          
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading bowler rankings:", error);
        document.getElementById('bowlerRankingsBody').innerHTML = `
          <tr>
            <td colspan="10" style="text-align: center; color: #f44336;">Error loading bowling rankings</td>
          </tr>
        `;
      }
    }
    
    // Load all-rounder rankings
    async function loadAllrounderRankings() {
      try {
        // Get all completed matches
        const matchesRef = ref(db, 'completedMatches');
        const matchesSnap = await get(matchesRef);
        
        if (!matchesSnap.exists()) {
          document.getElementById('allrounderRankingsBody').innerHTML = `
            <tr>
              <td colspan="8" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          return;
        }
        
        const matches = Object.values(matchesSnap.val());
        
        // Filter by format if needed
        const filteredMatches = currentFormat === 'all' 
          ? matches 
          : matches.filter(m => m.format === formatName(currentFormat));
        
        // Process all-rounder stats
        const allrounderStats = {};
        
        filteredMatches.forEach(match => {
          // Process player1 team
          if (match.player1Stats) {
            Object.entries(match.player1Stats).forEach(([player, stats]) => {
              if (!allrounderStats[player]) {
                allrounderStats[player] = initAllrounderStats(player, match.player1.team);
              }
              updateAllrounderStats(allrounderStats[player], stats, match.winner === 'player1');
            });
          }
          
          // Process player2 team
          if (match.player2Stats) {
            Object.entries(match.player2Stats).forEach(([player, stats]) => {
              if (!allrounderStats[player]) {
                allrounderStats[player] = initAllrounderStats(player, match.player2.team);
              }
              updateAllrounderStats(allrounderStats[player], stats, match.winner === 'player2');
            });
          }
        });
        
        // Convert to array and sort by all-round performance
        const allroundersArray = Object.values(allrounderStats)
          .filter(a => a.batInnings > 0 && a.bowlInnings > 0)
          .sort((a, b) => {
            // Sort by runs + wickets*25 + POM*50 + doublePerformances*30
            const aScore = a.runs + (a.wickets * 25) + (a.playerOfMatch * 50) + (a.doublePerformances * 30);
            const bScore = b.runs + (b.wickets * 25) + (b.playerOfMatch * 50) + (b.doublePerformances * 30);
            return bScore - aScore;
          });
        
        // Update top stats
        if (allroundersArray.length > 0) {
          // Most runs + wickets
          const topAllrounder = [...allroundersArray].sort((a, b) => (b.runs + b.wickets) - (a.runs + a.wickets))[0];
          document.getElementById('topAllrounderRunsWickets').textContent = `${topAllrounder.runs}+${topAllrounder.wickets} (${topAllrounder.name})`;
          
          // Most POM awards
          const mostPOM = [...allroundersArray].sort((a, b) => b.playerOfMatch - a.playerOfMatch)[0];
          document.getElementById('topAllrounderMatches').textContent = `${mostPOM.playerOfMatch} (${mostPOM.name})`;
          
          // Most double performances
          const mostDoubles = [...allroundersArray].sort((a, b) => b.doublePerformances - a.doublePerformances)[0];
          document.getElementById('topAllrounderDouble').textContent = `${mostDoubles.doublePerformances} (${mostDoubles.name})`;
        }
        
        // Update table
        const tbody = document.getElementById('allrounderRankingsBody');
        tbody.innerHTML = '';
        
        allroundersArray.forEach((player, index) => {
          const tr = document.createElement('tr');
          if (index < 3) tr.classList.add('highlight');
          
          const batAvg = player.batInnings > 0 ? (player.runs / player.batInnings).toFixed(2) : '-';
          const bowlAvg = player.wickets > 0 ? (player.runsConceded / player.wickets).toFixed(2) : '-';
          
          tr.innerHTML = `
            <td class="rank">
              ${index + 1}
              ${index === 0 ? '<span class="medal-gold"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 1 ? '<span class="medal-silver"><i class="fas fa-medal"></i></span>' : ''}
              ${index === 2 ? '<span class="medal-bronze"><i class="fas fa-medal"></i></span>' : ''}
            </td>
            <td class="player-name">${player.name}</td>
            <td class="team-name">${player.team}</td>
            <td>${player.runs}</td>
            <td>${player.wickets}</td>
            <td>${batAvg}</td>
            <td>${bowlAvg}</td>
            <td>${player.playerOfMatch}</td>
            <td>${player.doublePerformances}</td>
          `;
          
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading all-rounder rankings:", error);
        document.getElementById('allrounderRankingsBody').innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; color: #f44336;">Error loading all-rounder rankings</td>
          </tr>
        `;
      }
    }
    
    // Load milestones
    async function loadMilestones() {
      try {
        // Get all completed matches
        const matchesRef = ref(db, 'completedMatches');
        const matchesSnap = await get(matchesSnap);
        
        if (!matchesSnap.exists()) {
          document.getElementById('centuriesBody').innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          document.getElementById('fiveWicketsBody').innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center;">No match data available yet</td>
            </tr>
          `;
          return;
        }
        
        const matches = Object.values(matchesSnap.val());
        
        // Filter by format if needed
        const filteredMatches = currentFormat === 'all' 
          ? matches 
          : matches.filter(m => m.format === formatName(currentFormat));
        
        // Process milestones
        const centuries = [];
        const fiveWickets = [];
        let totalCenturies = 0;
        let totalHalfCenturies = 0;
        let totalFiveWickets = 0;
        let totalHatTricks = 0;
        
        filteredMatches.forEach(match => {
          // Process player1 team
          if (match.player1Stats) {
            Object.entries(match.player1Stats).forEach(([player, stats]) => {
              if (stats.runs >= 100) {
                centuries.push({
                  player: player,
                  team: match.player1.team,
                  runs: stats.runs,
                  balls: stats.balls,
                  fours: stats.fours,
                  sixes: stats.sixes,
                  match: `${match.player1.team} vs ${match.player2.team}`,
                  date: new Date(match.timestamp).toLocaleDateString()
                });
                totalCenturies++;
              } else if (stats.runs >= 50) {
                totalHalfCenturies++;
              }
              
              if (stats.wickets >= 5) {
                fiveWickets.push({
                  player: player,
                  team: match.player1.team,
                  wickets: stats.wickets,
                  runs: stats.runsConceded,
                  overs: stats.overs,
                  match: `${match.player1.team} vs ${match.player2.team}`,
                  date: new Date(match.timestamp).toLocaleDateString()
                });
                totalFiveWickets++;
              }
              
              // Check for hat-tricks (3 wickets in 3 consecutive balls)
              if (stats.wickets >= 3) {
                // This is a simplified check - in a real app you'd need to track ball-by-ball data
                totalHatTricks++;
              }
            });
          }
          
          // Process player2 team
          if (match.player2Stats) {
            Object.entries(match.player2Stats).forEach(([player, stats]) => {
              if (stats.runs >= 100) {
                centuries.push({
                  player: player,
                  team: match.player2.team,
                  runs: stats.runs,
                  balls: stats.balls,
                  fours: stats.fours,
                  sixes: stats.sixes,
                  match: `${match.player1.team} vs ${match.player2.team}`,
                  date: new Date(match.timestamp).toLocaleDateString()
                });
                totalCenturies++;
              } else if (stats.runs >= 50) {
                totalHalfCenturies++;
              }
              
              if (stats.wickets >= 5) {
                fiveWickets.push({
                  player: player,
                  team: match.player2.team,
                  wickets: stats.wickets,
                  runs: stats.runsConceded,
                  overs: stats.overs,
                  match: `${match.player1.team} vs ${match.player2.team}`,
                  date: new Date(match.timestamp).toLocaleDateString()
                });
                totalFiveWickets++;
              }
              
              if (stats.wickets >= 3) {
                totalHatTricks++;
              }
            });
          }
        });
        
        // Update milestone counts
        document.getElementById('totalCenturies').textContent = totalCenturies;
        document.getElementById('totalHalfCenturies').textContent = totalHalfCenturies;
        document.getElementById('totalFiveWickets').textContent = totalFiveWickets;
        document.getElementById('totalHatTricks').textContent = totalHatTricks;
        
        // Sort centuries by runs (descending)
        centuries.sort((a, b) => b.runs - a.runs);
        
        // Update centuries table
        const centuriesBody = document.getElementById('centuriesBody');
        centuriesBody.innerHTML = '';
        
        if (centuries.length === 0) {
          centuriesBody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center;">No centuries scored yet</td>
            </tr>
          `;
        } else {
          centuries.slice(0, 10).forEach(century => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td class="player-name">${century.player}</td>
              <td class="team-name">${century.team}</td>
              <td>${century.runs}</td>
              <td>${century.balls}</td>
              <td>${century.fours}/${century.sixes}</td>
              <td>${century.match}</td>
              <td>${century.date}</td>
            `;
            centuriesBody.appendChild(tr);
          });
        }
        
        // Sort five-wicket hauls by wickets (descending), then runs (ascending)
        fiveWickets.sort((a, b) => {
          if (b.wickets !== a.wickets) return b.wickets - a.wickets;
          return a.runs - b.runs;
        });
        
        // Update five-wicket table
        const fiveWicketsBody = document.getElementById('fiveWicketsBody');
        fiveWicketsBody.innerHTML = '';
        
        if (fiveWickets.length === 0) {
          fiveWicketsBody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center;">No 5-wicket hauls yet</td>
            </tr>
          `;
        } else {
          fiveWickets.slice(0, 10).forEach(haul => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td class="player-name">${haul.player}</td>
              <td class="team-name">${haul.team}</td>
              <td>${haul.wickets}</td>
              <td>${haul.runs}</td>
              <td>${haul.overs.toFixed(1)}</td>
              <td>${haul.match}</td>
              <td>${haul.date}</td>
            `;
            fiveWicketsBody.appendChild(tr);
          });
        }
      } catch (error) {
        console.error("Error loading milestones:", error);
        document.getElementById('centuriesBody').innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; color: #f44336;">Error loading centuries</td>
          </tr>
        `;
        document.getElementById('fiveWicketsBody').innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; color: #f44336;">Error loading 5-wicket hauls</td>
          </tr>
        `;
      }
    }
    
    // Helper functions for stats initialization and updating
    
    function initPlayerStats(name, team) {
      return {
        name: name,
        team: team,
        matches: 0,
        wins: 0,
        runs: 0,
        wickets: 0,
        runsConceded: 0,
        batInnings: 0,
        bowlInnings: 0,
        balls: 0,
        overs: 0,
        fours: 0,
        sixes: 0,
        fifties: 0,
        hundreds: 0,
        fiveWickets: 0,
        playerOfMatch: 0,
        doublePerformances: 0 // 50+ runs and 3+ wickets in same match
      };
    }
    
    function updatePlayerStats(player, stats, isWinner) {
      player.matches++;
      if (isWinner) player.wins++;
      
      if (stats.runs !== undefined) {
        player.runs += stats.runs;
        player.batInnings++;
        player.balls += stats.balls || 0;
        player.fours += stats.fours || 0;
        player.sixes += stats.sixes || 0;
        
        if (stats.runs >= 50) player.fifties++;
        if (stats.runs >= 100) player.hundreds++;
      }
      
      if (stats.wickets !== undefined) {
        player.wickets += stats.wickets;
        player.bowlInnings++;
        player.runsConceded += stats.runsConceded || 0;
        player.overs += stats.overs || 0;
        
        if (stats.wickets >= 5) player.fiveWickets++;
      }
      
      if (stats.playerOfMatch) player.playerOfMatch++;
      
      if ((stats.runs >= 50) && (stats.wickets >= 3)) {
        player.doublePerformances++;
      }
    }
    
    function initTeamStats(name) {
      return {
        name: name,
        matches: 0,
        wins: 0,
        losses: 0,
        chases: 0,
        defends: 0,
        highestScore: 0,
        lowestScore: Infinity,
        totalRuns: 0,
        totalWickets: 0
      };
    }
    
    function updateTeamStats(team, match, isWinner) {
      team.matches++;
      
      if (isWinner) {
        team.wins++;
        
        // Check if this was a successful chase
        if (match.toss && match.toss.battingFirst !== match.toss.winner) {
          team.chases++;
        } else {
          team.defends++;
        }
      } else {
        team.losses++;
      }
      
      // Update team scores
      const team1Score = match.player1.totalRuns || 0;
      const team2Score = match.player2.totalRuns || 0;
      
      if (team.name === match.player1.team) {
        team.totalRuns += team1Score;
        team.totalWickets += match.player1.totalWickets || 0;
        
        if (team1Score > team.highestScore) team.highestScore = team1Score;
        if (team1Score < team.lowestScore) team.lowestScore = team1Score;
      }
      
      if (team.name === match.player2.team) {
        team.totalRuns += team2Score;
        team.totalWickets += match.player2.totalWickets || 0;
        
        if (team2Score > team.highestScore) team.highestScore = team2Score;
        if (team2Score < team.lowestScore) team.lowestScore = team2Score;
      }
    }
    
    function initBatterStats(name, team) {
      return {
        name: name,
        team: team,
        innings: 0,
        runs: 0,
        balls: 0,
        average: 0,
        strikeRate: 0,
        fours: 0,
        sixes: 0,
        fifties: 0,
        hundreds: 0,
        highestScore: 0,
        notOuts: 0
      };
    }
    
    function updateBatterStats(batter, stats) {
      if (stats.runs === undefined) return;
      
      batter.innings++;
      batter.runs += stats.runs;
      batter.balls += stats.balls || 0;
      batter.fours += stats.fours || 0;
      batter.sixes += stats.sixes || 0;
      
      if (stats.runs >= 50) batter.fifties++;
      if (stats.runs >= 100) batter.hundreds++;
      
      if (stats.runs > batter.highestScore) {
        batter.highestScore = stats.runs;
      }
      
      if (!stats.out) batter.notOuts++;
      
      batter.average = batter.innings > 0 ? (batter.runs / (batter.innings - batter.notOuts)) : 0;
      batter.strikeRate = batter.balls > 0 ? ((batter.runs / batter.balls) * 100) : 0;
    }
    
    function initBowlerStats(name, team) {
      return {
        name: name,
        team: team,
        innings: 0,
        wickets: 0,
        runsConceded: 0,
        overs: 0,
        balls: 0,
        average: 0,
        economy: 0,
        strikeRate: 0,
        fiveWickets: 0,
        bestWickets: 0,
        bestRuns: 0
      };
    }
    
    function updateBowlerStats(bowler, stats) {
      if (stats.wickets === undefined) return;
      
      bowler.innings++;
      bowler.wickets += stats.wickets;
      bowler.runsConceded += stats.runsConceded || 0;
      bowler.overs += stats.overs || 0;
      bowler.balls += (stats.overs || 0) * 6;
      
      if (stats.wickets >= 5) bowler.fiveWickets++;
      
      // Update best bowling
      if (stats.wickets > bowler.bestWickets || 
          (stats.wickets === bowler.bestWickets && stats.runsConceded < bowler.bestRuns)) {
        bowler.bestWickets = stats.wickets;
        bowler.bestRuns = stats.runsConceded || 0;
      }
      
      bowler.average = bowler.wickets > 0 ? (bowler.runsConceded / bowler.wickets) : 0;
      bowler.economy = bowler.overs > 0 ? (bowler.runsConceded / bowler.overs) : 0;
      bowler.strikeRate = bowler.wickets > 0 ? (bowler.balls / bowler.wickets) : 0;
    }
    
    function initAllrounderStats(name, team) {
      return {
        name: name,
        team: team,
        matches: 0,
        wins: 0,
        runs: 0,
        wickets: 0,
        runsConceded: 0,
        batInnings: 0,
        bowlInnings: 0,
        balls: 0,
        overs: 0,
        fours: 0,
        sixes: 0,
        fifties: 0,
        hundreds: 0,
        fiveWickets: 0,
        playerOfMatch: 0,
        doublePerformances: 0
      };
    }
    
    function updateAllrounderStats(player, stats, isWinner) {
      player.matches++;
      if (isWinner) player.wins++;
      
      if (stats.runs !== undefined) {
        player.runs += stats.runs;
        player.batInnings++;
        player.balls += stats.balls || 0;
        player.fours += stats.fours || 0;
        player.sixes += stats.sixes || 0;
        
        if (stats.runs >= 50) player.fifties++;
        if (stats.runs >= 100) player.hundreds++;
      }
      
      if (stats.wickets !== undefined) {
        player.wickets += stats.wickets;
        player.bowlInnings++;
        player.runsConceded += stats.runsConceded || 0;
        player.overs += stats.overs || 0;
        
        if (stats.wickets >= 5) player.fiveWickets++;
      }
      
      if (stats.playerOfMatch) player.playerOfMatch++;
      
      if ((stats.runs >= 50) && (stats.wickets >= 3)) {
        player.doublePerformances++;
      }
    }
    
    function formatName(formatKey) {
      const formats = {
        '5': 'T5 (5 Overs)',
        '10': 'T10 (10 Overs)',
        '20': 'T20 (20 Overs)',
        '50': 'ODI (50 Overs)'
      };
      return formats[formatKey] || formatKey;
    }
    
    // Load initial data
    loadPlayerRankings();
  </script>
</body>
  </html>
