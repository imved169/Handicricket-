<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HandiCricket - Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #1e88e5;
      --primary-dark: #1565c0;
      --secondary: #ffeb3b;
      --secondary-dark: #fbc02d;
      --success: #4CAF50;
      --success-dark: #2E7D32;
      --warning: #FF9800;
      --warning-dark: #F57C00;
      --danger: #f44336;
      --danger-dark: #d32f2f;
      --purple: #9C27B0;
      --purple-dark: #7B1FA2;
      --dark-blue: #061e3e;
      --medium-blue: #0a2a4a;
      --light-blue: #0f3a64;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(135deg, var(--dark-blue), var(--medium-blue));
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      padding: 8px;
      margin: 0;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 10px;
      padding: 8px;
      box-sizing: border-box;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    
    h1 { 
      margin: 8px 0 12px;
      color: var(--secondary);
      text-shadow: 0 0 5px rgba(255, 235, 59, 0.5);
      font-size: 1.5rem;
    }
    
    /* Enhanced Scoreboard */
    .scorebox-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px;
      background: rgba(13, 42, 82, 0.8);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .team-score {
      display: flex;
      flex-direction: column;
    }

    .score-large {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--secondary);
    }

    .score-details {
      text-align: right;
      font-size: 0.85rem;
    }

    /* Live score ticker */
    .live-ticker {
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 6px;
      border-radius: 4px;
      margin: 6px 0;
      font-size: 0.8rem;
      white-space: nowrap;
      overflow: hidden;
      position: relative;
    }
    
    .ticker-content {
      display: inline-block;
      padding-left: 100%;
      animation: ticker 20s linear infinite;
    }
    
    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    
    .ticker-item {
      display: inline-block;
      margin-right: 30px;
    }
    
    .ticker-item span {
      margin: 0 5px;
      color: var(--secondary);
      font-weight: bold;
    }

    /* Match Info Bar */
    .match-info-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(13, 42, 82, 0.5);
      padding: 6px 8px;
      border-radius: 6px;
      margin: 4px 0 8px 0;
      font-size: 0.75rem;
      gap: 6px;
      flex-wrap: wrap;
    }

    .match-info-item {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 45%;
    }

    .divider {
      color: #666;
      flex-shrink: 0;
    }

    /* Over Progress */
    .over-progress {
      background: rgba(13, 42, 82, 0.5);
      padding: 6px;
      border-radius: 6px;
      margin: 6px 0;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .over-title {
      font-size: 0.75rem;
      color: #aaa;
      margin-bottom: 4px;
    }

    .balls-container {
      display: flex;
      gap: 4px;
    }

    .ball {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .ball.dot {
      background: #333;
      color: white;
    }

    .ball.run {
      background: var(--success);
      color: white;
    }

    .ball.wicket {
      background: var(--danger);
      color: white;
    }

    .ball.wide {
      background: var(--warning);
      color: white;
    }

    .ball.noball {
      background: var(--purple);
      color: white;
    }

    .ball.empty {
      background: rgba(255,255,255,0.1);
    }

    .over-number {
      text-align: right;
      font-size: 0.75rem;
      margin-top: 4px;
      color: #aaa;
    }

    /* Timeline Styles */
    .timeline-container {
      background: rgba(13, 42, 82, 0.7);
      border-radius: 8px;
      margin: 8px 0;
      padding: 6px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .timeline-container h4 {
      margin: 0 0 6px 0;
      font-size: 0.85rem;
    }

    .timeline {
      display: flex;
      overflow-x: auto;
      gap: 6px;
      padding-bottom: 4px;
    }

    .timeline-item {
      min-width: 70px;
      padding: 4px;
      border-radius: 4px;
      background: rgba(30, 136, 229, 0.2);
      font-size: 0.7rem;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .timeline-item.wicket {
      background: rgba(244, 67, 54, 0.2);
      border-left: 2px solid var(--danger);
    }

    .timeline-item.boundary {
      background: rgba(255, 193, 7, 0.2);
      border-left: 2px solid var(--warning);
    }

    .timeline-item.milestone {
      background: rgba(76, 175, 80, 0.2);
      border-left: 2px solid var(--success);
    }

    .timeline-over {
      font-weight: bold;
      margin-bottom: 2px;
    }

    .timeline-event {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Player Comparison Styles - Enhanced */
    .comparison-container {
      background: rgba(13, 42, 82, 0.7);
      border-radius: 8px;
      margin: 8px 0;
      padding: 6px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .comparison-container h4 {
      margin: 0 0 6px 0;
      font-size: 0.85rem;
    }

    .comparison-box {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .player-comparison {
      flex: 1;
      padding: 6px;
      border-radius: 6px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .batter-comparison {
      background: rgba(76, 175, 80, 0.1);
      border-left: 3px solid var(--success);
    }

    .bowler-comparison {
      background: rgba(244, 67, 54, 0.1);
      border-left: 3px solid var(--danger);
    }

    .comparison-header {
      font-size: 0.65rem;
      text-transform: uppercase;
      color: #aaa;
      margin-bottom: 4px;
    }

    .comparison-name {
      font-weight: bold;
      margin: 4px 0;
      font-size: 0.85rem;
    }
    
    .comparison-name.highlight {
      animation: highlightPlayer 2s infinite;
    }
    
    @keyframes highlightPlayer {
      0% { text-shadow: 0 0 5px rgba(255,255,255,0.5); }
      50% { text-shadow: 0 0 15px gold; }
      100% { text-shadow: 0 0 5px rgba(255,255,255,0.5); }
    }

    .comparison-stats {
      font-size: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .comparison-stats div {
      flex: 1;
      min-width: 50%;
      margin: 2px 0;
    }

    .vs-circle {
      width: 30px;
      height: 30px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.65rem;
      border: 2px solid white;
    }

    /* Animations */
    @keyframes scoreIncrease {
      0% { transform: scale(1); color: white; }
      50% { transform: scale(1.3); color: var(--success); }
      100% { transform: scale(1); color: white; }
    }

    @keyframes wicketFlash {
      0% { background-color: rgba(244, 67, 54, 0); }
      50% { background-color: rgba(244, 67, 54, 0.3); }
      100% { background-color: rgba(244, 67, 54, 0); }
    }

    @keyframes boundary {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); color: var(--warning); }
      100% { transform: scale(1); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes ballTrail {
      0% { transform: translateX(0) translateY(0); opacity: 1; }
      100% { transform: translateX(100px) translateY(-50px); opacity: 0; }
    }
    
    @keyframes stumpFall {
      0% { transform: rotate(0); }
      100% { transform: rotate(-45deg); }
    }
    
    @keyframes screenShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
    
    @keyframes ripple {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(3); opacity: 0; }
    }

    .score-change {
      animation: scoreIncrease 0.8s ease-in-out;
    }

    .wicket-flash {
      animation: wicketFlash 1.5s ease-in-out;
    }

    .boundary-flash {
      animation: boundary 1s ease-in-out;
    }
    
    .screen-shake {
      animation: screenShake 0.5s ease-in-out;
    }

    /* Card Buttons */
    .card-btns { 
      margin: 10px auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      position: relative;
    }
    
    .card-btns button { 
      width: 50px;
      height: 50px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(145deg, var(--primary), var(--primary-dark));
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .card-btns button::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255,255,255,0.1);
      transform: rotate(45deg);
      transition: all 0.3s;
      opacity: 0;
    }
    
    .card-btns button:hover::after {
      opacity: 1;
      top: -30%;
      left: -30%;
    }
    
    .card-btns button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
    }
    
    .card-btns button:active {
      transform: translateY(1px);
    }
    
    .card-btns button:disabled { 
      background: #607d8b;
      color: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .card-btns button.selected {
      background: var(--success);
      border: 2px solid var(--secondary);
      transform: scale(1.05);
    }
    
    /* Status Indicators */
    #statusIndicators {
      margin: 6px 0;
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .free-hit-indicator,
    .powerplay-indicator,
    .dead-over {
      padding: 3px 6px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
      margin: 0 2px;
      display: inline-block;
    }
    
    .free-hit-indicator {
      background: var(--success);
      color: white;
      animation: pulse 1.5s infinite;
    }
    
    .powerplay-indicator {
      background: var(--secondary);
      color: #000;
      animation: pulse 2s infinite;
    }
    
    .dead-over {
      background: var(--danger);
      color: white;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* Result Display */
    #result {
      font-size: 15px;
      margin: 8px 0;
      padding: 6px;
      min-height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.5);
      border-radius: 6px;
      border-left: 3px solid var(--primary);
    }
    
    #result.error {
      color: #ff4444;
      background: rgba(255, 0, 0, 0.1);
      padding: 6px;
      border-radius: 4px;
      border-left: 3px solid #ff4444;
    }
    
    /* Connection Status */
    #connectionStatus {
      padding: 6px;
      border-radius: 6px;
      text-align: center;
      margin: 8px auto;
      max-width: 250px;
      font-weight: bold;
      font-size: 13px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .online { 
      background: var(--success);
      color: white;
    }
    
    .offline { 
      background: var(--danger);
      color: white;
    }
    
    /* Selection Modal */
    .selection-modal { 
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 350px;
      background: linear-gradient(145deg, var(--dark-blue), var(--medium-blue));
      padding: 10px;
      border-radius: 12px;
      margin-bottom: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 100;
      display: none;
    }
    
    .selection-list { 
      max-height: 50vh;
      overflow-y: auto;
      margin: 6px 0;
      padding-right: 4px;
    }
    
    .player-item, .batter-item {
      padding: 6px;
      margin: 3px 0;
      background: rgba(30, 136, 229, 0.2);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
      font-size: 13px;
    }
    
    .player-item:hover, .batter-item:hover {
      background: rgba(30, 136, 229, 0.4);
      transform: translateX(5px);
    }
    
    .player-item.selected, .batter-item.selected {
      background: rgba(13, 71, 161, 0.6);
      border-left: 3px solid var(--secondary);
    }
    
    /* Top Controls */
    #topControls {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    
    #topControls button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    #saveBtn { 
      background: var(--warning);
      color: white;
    }
    
    #saveBtn:hover {
      background: var(--warning-dark);
    }
    
    #exitBtn { 
      background: var(--danger);
      color: white;
    }
    
    #exitBtn:hover {
      background: var(--danger-dark);
    }
    
    #resetPlaysBtn { 
      background: var(--purple);
      color: white;
    }
    
    #resetPlaysBtn:hover {
      background: var(--purple-dark);
    }
    
    #declareBtn {
      background: linear-gradient(145deg, #FF5722, #E64A19);
      color: white;
    }
    
    #declareBtn:hover {
      background: linear-gradient(145deg, #E64A19, #D84315);
    }
    
    /* Teams Modal */
    .teams-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .teams-container {
      width: 90%;
      max-width: 320px;
      height: 65vh;
      display: flex;
      overflow: hidden;
      position: relative;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    .team-slide {
      min-width: 100%;
      height: 100%;
      padding: 8px;
      background: rgba(13, 42, 82, 0.9);
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      overflow-y: auto;
      scroll-snap-align: start;
      flex-shrink: 0;
      box-sizing: border-box;
    }

    .team-slide h3 {
      text-align: center;
      margin-bottom: 6px;
      color: var(--secondary);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 3px;
      font-size: 0.95rem;
      position: sticky;
      top: 0;
      background: rgba(13, 42, 82, 0.9);
      z-index: 1;
    }

    .team-slide ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .team-slide li {
      padding: 6px 8px;
      margin: 3px 0;
      background: rgba(30, 136, 229, 0.2);
      border-radius: 6px;
      border-left: 2px solid var(--primary);
      transition: all 0.3s;
      font-size: 13px;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .team-slide li:hover {
      background: rgba(30, 136, 229, 0.4);
      transform: translateX(5px);
    }

    .close-teams {
      position: absolute;
      top: 12px;
      right: 12px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 16px;
      cursor: pointer;
      z-index: 1001;
      transition: all 0.2s;
    }
    
    .close-teams:hover {
      transform: scale(1.1);
    }

    .teams-nav {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
    }

    .team-nav-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      background: var(--primary);
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .team-nav-btn:hover {
      background: var(--primary-dark);
    }

    .team-nav-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }

    .team-nav-indicator {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }

    .team-nav-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #555;
      cursor: pointer;
      transition: all 0.2s;
    }

    .team-nav-dot.active {
      background: var(--primary);
      transform: scale(1.2);
    }

    .show-teams-btn {
      padding: 8px 16px;
      font-size: 13px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--purple), var(--purple-dark));
      color: white;
      cursor: pointer;
      margin: 12px auto;
      display: block;
      transition: all 0.3s;
    }

    .show-teams-btn:hover {
      background: linear-gradient(135deg, var(--purple-dark), #6a1b9a);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* Team Names Display */
    .team-names-compact {
      margin-bottom: 8px;
      font-size: 13px;
      background: rgba(13, 42, 82, 0.5);
      padding: 6px;
      border-radius: 6px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .team-name-line {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 4px;
    }

    .team-label {
      color: #aaa;
      font-size: 11px;
    }

    .team-divider {
      color: #666;
      margin: 0 4px;
    }

    /* Over Summary */
    .over-summary-container {
      margin: 8px 0;
      padding: 6px;
      background: rgba(13, 42, 82, 0.5);
      border-radius: 6px;
      max-height: 100px;
      overflow-y: auto;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .over-summary-item {
      padding: 3px;
      margin: 3px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 12px;
    }

    /* Spectator Mode */
    .spectator-mode {
      background: var(--purple);
      padding: 3px 6px;
      border-radius: 15px;
      margin-bottom: 6px;
      display: inline-block;
      font-size: 11px;
      animation: pulse 2s infinite;
    }

    /* Milestone Notifications */
    .milestone-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 15px;
      z-index: 1001;
      animation: fadeInOut 3s forwards;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.2);
      max-width: 250px;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(5px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(5px); }
    }
    
    .milestone-notification.batting {
      border-left: 4px solid var(--success);
    }
    
    .milestone-notification.error {
      border-left: 4px solid var(--danger);
    }
    
    .milestone-notification.info {
      border-left: 4px solid var(--warning);
    }
    
    .milestone-notification.winner {
      border-left: 4px solid var(--purple);
      font-size: 18px;
      background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(70,0,100,0.9));
    }
    
    /* Confetti */
    .confetti {
      position: fixed;
      width: 8px;
      height: 8px;
      background-color: #f00;
      animation: confetti-fall 5s linear forwards;
      z-index: 1000;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Loading Spinner */
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid var(--primary);
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 12px auto;
      display: none;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Reset Notification */
    .reset-notification {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      z-index: 1001;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 80%;
      max-width: 280px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .reset-notification-buttons {
      display: flex;
      justify-content: center;
      gap: 6px;
    }
    
    .reset-notification button {
      padding: 4px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 11px;
      transition: all 0.2s;
    }
    
    .reset-accept {
      background: var(--success);
      color: white;
    }
    
    .reset-accept:hover {
      background: var(--success-dark);
    }
    
    .reset-decline {
      background: var(--danger);
      color: white;
    }
    
    .reset-decline:hover {
      background: var(--danger-dark);
    }
    
    /* Innings Summary Popup */
    .summary-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, var(--dark-blue), var(--medium-blue));
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 1001;
      text-align: center;
      color: white;
      max-width: 320px;
      width: 90%;
      display: none;
    }
    
    .summary-popup h3 {
      margin-top: 0;
      color: var(--secondary);
      font-size: 1.2rem;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 6px;
      margin-bottom: 12px;
    }
    
    .summary-content {
      text-align: left;
      margin-bottom: 12px;
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 13px;
    }
    
    .summary-label {
      color: #aaa;
    }
    
    .summary-value {
      font-weight: bold;
    }
    
    .summary-highlight {
      background: rgba(255, 235, 59, 0.2);
      padding: 4px;
      border-radius: 4px;
      margin: 8px 0;
      font-weight: bold;
      text-align: center;
      border-left: 3px solid var(--secondary);
    }
    
    .summary-countdown {
      font-size: 22px;
      font-weight: bold;
      margin: 8px 0;
      color: var(--success);
    }
    
    .summary-popup button {
      background: var(--success);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      margin-top: 8px;
      transition: all 0.3s;
      width: 100%;
    }
    
    .summary-popup button:hover {
      background: var(--success-dark);
      transform: scale(1.05);
    }
    
    /* Match graphics */
    .match-graphics {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
    
    .ball-trail {
      position: absolute;
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      z-index: 1000;
      animation: ballTrail 0.5s forwards;
    }
    
    .stump {
      position: absolute;
      width: 5px;
      height: 30px;
      background: #8B4513;
      bottom: 50px;
      transform-origin: bottom center;
    }
    
    .stump.left {
      left: calc(50% - 15px);
    }
    
    .stump.middle {
      left: 50%;
      transform: translateX(-50%);
    }
    
    .stump.right {
      left: calc(50% + 10px);
    }
    
    .stump.bail {
      width: 20px;
      height: 5px;
      background: #D2B48C;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
    }
    
    .ripple-effect {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      animation: ripple 1s forwards;
      z-index: 999;
    }
    
    /* Mini scorecard */
    .mini-scorecard {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 8px;
      border-radius: 6px;
      font-size: 12px;
      z-index: 100;
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    
    .mini-scorecard .score {
      font-weight: bold;
      color: var(--secondary);
    }
    
    /* Match awards */
    .awards-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      justify-content: center;
    }
    
    .award-badge {
      background: rgba(255,215,0,0.2);
      border: 1px solid gold;
      padding: 4px 8px;
      border-radius: 15px;
      font-size: 11px;
      color: gold;
    }
    
    /* Responsive adjustments */
    @media (max-width: 320px) {
      .card-btns button {
        width: 45px;
        height: 45px;
        font-size: 16px;
      }
      
      .score-large {
        font-size: 1.5rem;
      }
    }
    
    @media (min-width: 768px) {
      .container {
        max-width: 600px;
        padding: 16px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .card-btns button {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
      
      .score-large {
        font-size: 2.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>HandiCricket</h1>
    
    <!-- Match Info Bar -->
    <div class="match-info-bar">
      <div class="match-info-item">Format: <span id="matchFormat">T20</span></div>
      <div class="divider">|</div>
      <div class="match-info-item">Innings: <span id="inningsNumber">1</span></div>
      <div class="divider">|</div>
      <div class="match-info-item">Day: <span id="matchDay">1</span></div>
      <div class="divider">|</div>
      <div class="match-info-item">Session: <span id="matchSession">1</span></div>
    </div>
    
    <!-- Team Names -->
    <div class="team-names-compact">
      <div class="team-name-line">
        <span class="team-label">Batting:</span>
        <span id="battingTeamName">Team A</span>
      </div>
      <div class="team-name-line">
        <span class="team-label">Bowling:</span>
        <span id="bowlingTeamName">Team B</span>
      </div>
    </div>
    
    <!-- Main Scoreboard -->
    <div class="scorebox-main">
      <div class="team-score">
        <div class="score-large" id="runs">0</div>
        <div class="score-details" id="wickets">0/0</div>
      </div>
      <div class="score-details">
        <div>Overs: <span id="overs">0.0</span></div>
        <div>Run Rate: <span id="runRate">0.00</span></div>
        <div id="targetDisplay">Target: <span id="target">-</span></div>
      </div>
    </div>
    
    <!-- Live Ticker -->
    <div class="live-ticker">
      <div class="ticker-content">
        <div class="ticker-item">LIVE: <span id="tickerText">Match about to begin</span></div>
      </div>
    </div>
    
    <!-- Status Indicators -->
    <div id="statusIndicators">
      <!-- Will be populated with powerplay, free hit, etc. indicators -->
    </div>
    
    <!-- Over Progress -->
    <div class="over-progress">
      <div class="over-title">Current Over</div>
      <div class="balls-container" id="ballsContainer">
        <!-- Will be populated with ball indicators -->
      </div>
      <div class="over-number">Over <span id="overNumber">1</span></div>
    </div>
    
    <!-- Result Display -->
    <div id="result"></div>
    
    <!-- Player Comparison -->
    <div class="comparison-container">
      <h4>Current Players</h4>
      <div class="comparison-box">
        <div class="player-comparison batter-comparison">
          <div class="comparison-header">Batter</div>
          <div class="comparison-name" id="currentBatter">Player 1</div>
          <div class="comparison-stats">
            <div>Runs: <span id="batterRuns">0</span></div>
            <div>Balls: <span id="batterBalls">0</span></div>
            <div>SR: <span id="batterSR">0.00</span></div>
          </div>
        </div>
        
        <div class="vs-circle">VS</div>
        
        <div class="player-comparison bowler-comparison">
          <div class="comparison-header">Bowler</div>
          <div class="comparison-name" id="currentBowler">Player 2</div>
          <div class="comparison-stats">
            <div>Overs: <span id="bowlerOvers">0</span></div>
            <div>Wkts: <span id="bowlerWickets">0</span></div>
            <div>Econ: <span id="bowlerEcon">0.00</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Timeline -->
    <div class="timeline-container">
      <h4>Recent Events</h4>
      <div class="timeline" id="timeline">
        <!-- Will be populated with recent events -->
      </div>
    </div>
    
    <!-- Card Buttons -->
    <div class="card-btns" id="cardButtons">
      <button value="0">0</button>
      <button value="1">1</button>
      <button value="2">2</button>
      <button value="3">3</button>
      <button value="4">4</button>
      <button value="5">5</button>
      <button value="6">6</button>
    </div>
    
    <!-- Top Controls -->
    <div id="topControls">
      <button id="saveBtn"><i class="fas fa-save"></i> Save</button>
      <button id="exitBtn"><i class="fas fa-sign-out-alt"></i> Exit</button>
      <button id="resetPlaysBtn"><i class="fas fa-redo"></i> Reset</button>
      <button id="declareBtn" style="display:none"><i class="fas fa-flag"></i> Declare</button>
    </div>
    
    <!-- Connection Status -->
    <div id="connectionStatus" class="online">Connected</div>
    
    <!-- Selection Modal -->
    <div class="selection-modal" id="selectionModal">
      <h3 id="modalTitle">Select Player</h3>
      <div class="selection-list" id="selectionList">
        <!-- Will be populated with player options -->
      </div>
      <button id="confirmSelection">Confirm</button>
    </div>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner"></div>
    
    <!-- Show Teams Button -->
    <button class="show-teams-btn" id="showTeamsBtn">
      <i class="fas fa-users"></i> View Teams
    </button>
    
    <!-- Teams Modal -->
    <div class="teams-modal" id="teamsModal">
      <button class="close-teams" id="closeTeamsBtn">&times;</button>
      <div class="teams-container" id="teamsContainer">
        <div class="team-slide">
          <h3 id="team1Name">Team A</h3>
          <ul id="team1Players">
            <!-- Will be populated with team players -->
          </ul>
        </div>
        <div class="team-slide">
          <h3 id="team2Name">Team B</h3>
          <ul id="team2Players">
            <!-- Will be populated with team players -->
          </ul>
        </div>
      </div>
      <div class="teams-nav">
        <button class="team-nav-btn" id="prevTeamBtn" disabled>Previous</button>
        <button class="team-nav-btn" id="nextTeamBtn">Next</button>
      </div>
      <div class="team-nav-indicator">
        <div class="team-nav-dot active"></div>
        <div class="team-nav-dot"></div>
      </div>
    </div>
  </div>
  
  <!-- Match Graphics -->
  <div class="match-graphics" id="matchGraphics"></div>
  
  <!-- Mini Scorecard -->
  <div class="mini-scorecard">
    <span id="miniScore">0/0</span> (<span id="miniOvers">0.0</span> ov)
  </div>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Game state
    let gameState = {
      // Basic match info
      matchId: null,
      format: 'T20',
      innings: 1,
      day: 1,
      session: 1,
      oversPerDay: 90, // Default for Test matches
      
      // Teams
      battingTeam: null,
      bowlingTeam: null,
      battingTeamName: '',
      bowlingTeamName: '',
      
      // Score
      runs: 0,
      wickets: 0,
      balls: 0,
      overs: 0,
      target: 0,
      
      // Players
      currentBatter: null,
      currentBowler: null,
      batters: [],
      bowlers: [],
      
      // Status
      isPowerplay: false,
      isFreeHit: false,
      isDeadOver: false,
      isDeclared: false,
      isFollowOn: false,
      
      // Stats
      batterStats: {},
      bowlerStats: {},
      partnership: {
        runs: 0,
        balls: 0,
        batters: []
      },
      lastFiveDeliveries: [],
      
      // Game flow
      isGameOver: false,
      isInningsBreak: false,
      isSecondInnings: false,
      playerTurn: null,
      isTestMatch: false,
      
      // UI state
      selectedCard: null,
      isSelectingBatter: false,
      isSelectingBowler: false
    };
    
    // DOM elements
    const elements = {
      runs: document.getElementById('runs'),
      wickets: document.getElementById('wickets'),
      overs: document.getElementById('overs'),
      runRate: document.getElementById('runRate'),
      target: document.getElementById('target'),
      targetDisplay: document.getElementById('targetDisplay'),
      currentBatter: document.getElementById('currentBatter'),
      currentBowler: document.getElementById('currentBowler'),
      batterRuns: document.getElementById('batterRuns'),
      batterBalls: document.getElementById('batterBalls'),
      batterSR: document.getElementById('batterSR'),
      bowlerOvers: document.getElementById('bowlerOvers'),
      bowlerWickets: document.getElementById('bowlerWickets'),
      bowlerEcon: document.getElementById('bowlerEcon'),
      result: document.getElementById('result'),
      connectionStatus: document.getElementById('connectionStatus'),
      cardButtons: document.getElementById('cardButtons'),
      selectionModal: document.getElementById('selectionModal'),
      modalTitle: document.getElementById('modalTitle'),
      selectionList: document.getElementById('selectionList'),
      confirmSelection: document.getElementById('confirmSelection'),
      statusIndicators: document.getElementById('statusIndicators'),
      ballsContainer: document.getElementById('ballsContainer'),
      overNumber: document.getElementById('overNumber'),
      timeline: document.getElementById('timeline'),
      matchFormat: document.getElementById('matchFormat'),
      inningsNumber: document.getElementById('inningsNumber'),
      matchDay: document.getElementById('matchDay'),
      matchSession: document.getElementById('matchSession'),
      battingTeamName: document.getElementById('battingTeamName'),
      bowlingTeamName: document.getElementById('bowlingTeamName'),
      saveBtn: document.getElementById('saveBtn'),
      exitBtn: document.getElementById('exitBtn'),
      resetPlaysBtn: document.getElementById('resetPlaysBtn'),
      declareBtn: document.getElementById('declareBtn'),
      loadingSpinner: document.getElementById('loadingSpinner'),
      showTeamsBtn: document.getElementById('showTeamsBtn'),
      teamsModal: document.getElementById('teamsModal'),
      closeTeamsBtn: document.getElementById('closeTeamsBtn'),
      teamsContainer: document.getElementById('teamsContainer'),
      team1Name: document.getElementById('team1Name'),
      team1Players: document.getElementById('team1Players'),
      team2Name: document.getElementById('team2Name'),
      team2Players: document.getElementById('team2Players'),
      prevTeamBtn: document.getElementById('prevTeamBtn'),
      nextTeamBtn: document.getElementById('nextTeamBtn'),
      miniScore: document.getElementById('miniScore'),
      miniOvers: document.getElementById('miniOvers'),
      tickerText: document.getElementById('tickerText')
    };
    
    // Initialize the game
    function initGame() {
      // Get match ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const matchId = urlParams.get('matchId');
      
      if (!matchId) {
        showError('No match ID provided');
        return;
      }
      
      gameState.matchId = matchId;
      
      // Load match data from Firebase
      loadMatchData();
      
      // Set up event listeners
      setupEventListeners();
    }
    
    // Load match data from Firebase
    function loadMatchData() {
      elements.loadingSpinner.style.display = 'block';
      
      db.collection('matches').doc(gameState.matchId).get()
        .then((doc) => {
          if (doc.exists) {
            const matchData = doc.data();
            
            // Update game state with match data
            gameState.format = matchData.format || 'T20';
            gameState.battingTeam = matchData.battingTeam || matchData.team1;
            gameState.bowlingTeam = matchData.bowlingTeam || matchData.team2;
            gameState.battingTeamName = matchData.battingTeamName || matchData.team1Name;
            gameState.bowlingTeamName = matchData.bowlingTeamName || matchData.team2Name;
            gameState.oversPerDay = matchData.oversPerDay || 90;
            gameState.isTestMatch = gameState.format === 'Test';
            
            // Update UI
            updateUI();
            
            // Set up real-time listener for match updates
            setupRealtimeListener();
            
            // Check if it's second innings
            if (matchData.innings === 2) {
              gameState.innings = 2;
              gameState.isSecondInnings = true;
              gameState.target = matchData.target || 0;
              updateTargetDisplay();
            }
            
            // Show/hide declare button for Test matches
            if (gameState.isTestMatch) {
              elements.declareBtn.style.display = 'block';
            }
            
            // Populate teams modal
            populateTeamsModal(matchData);
            
          } else {
            showError('Match not found');
          }
          
          elements.loadingSpinner.style.display = 'none';
        })
        .catch((error) => {
          console.error('Error loading match data:', error);
          showError('Failed to load match data');
          elements.loadingSpinner.style.display = 'none';
        });
    }
    
    // Set up real-time listener for match updates
    function setupRealtimeListener() {
      db.collection('matches').doc(gameState.matchId)
        .onSnapshot((doc) => {
          if (doc.exists) {
            const matchData = doc.data();
            
            // Update game state with latest data
            if (matchData.runs !== undefined) gameState.runs = matchData.runs;
            if (matchData.wickets !== undefined) gameState.wickets = matchData.wickets;
            if (matchData.balls !== undefined) gameState.balls = matchData.balls;
            if (matchData.overs !== undefined) gameState.overs = matchData.overs;
            if (matchData.currentBatter !== undefined) gameState.currentBatter = matchData.currentBatter;
            if (matchData.currentBowler !== undefined) gameState.currentBowler = matchData.currentBowler;
            if (matchData.isPowerplay !== undefined) gameState.isPowerplay = matchData.isPowerplay;
            if (matchData.isFreeHit !== undefined) gameState.isFreeHit = matchData.isFreeHit;
            if (matchData.isDeadOver !== undefined) gameState.isDeadOver = matchData.isDeadOver;
            if (matchData.innings !== undefined) {
              gameState.innings = matchData.innings;
              gameState.isSecondInnings = matchData.innings === 2;
            }
            if (matchData.target !== undefined) gameState.target = matchData.target;
            
            // Update UI
            updateUI();
            
            // Update connection status
            elements.connectionStatus.textContent = 'Connected';
            elements.connectionStatus.className = 'online';
          }
        }, (error) => {
          console.error('Error in real-time listener:', error);
          elements.connectionStatus.textContent = 'Connection lost';
          elements.connectionStatus.className = 'offline';
        });
    }
    
    // Set up event listeners
    function setupEventListeners() {
      // Card button clicks
      const cardButtons = elements.cardButtons.querySelectorAll('button');
      cardButtons.forEach(button => {
        button.addEventListener('click', () => {
          if (gameState.isGameOver || gameState.isInningsBreak) return;
          
          const value = parseInt(button.value);
          playCard(value);
        });
      });
      
      // Confirm selection button
      elements.confirmSelection.addEventListener('click', confirmSelection);
      
      // Top control buttons
      elements.saveBtn.addEventListener('click', saveGameState);
      elements.exitBtn.addEventListener('click', exitGame);
      elements.resetPlaysBtn.addEventListener('click', resetPlays);
      elements.declareBtn.addEventListener('click', declareInnings);
      
      // Teams modal
      elements.showTeamsBtn.addEventListener('click', showTeamsModal);
      elements.closeTeamsBtn.addEventListener('click', hideTeamsModal);
      elements.prevTeamBtn.addEventListener('click', showPreviousTeam);
      elements.nextTeamBtn.addEventListener('click', showNextTeam);
    }
    
    // Play a card
    function playCard(cardValue) {
      // In a real implementation, this would:
      // 1. Validate the play
      // 2. Calculate outcome based on game rules
      // 3. Update game state
      // 4. Save to Firebase
      // 5. Update UI with animations
      
      // For demo purposes, we'll simulate a play
      simulatePlay(cardValue);
    }
    
    // Simulate a play (for demo purposes)
    function simulatePlay(cardValue) {
      // Generate a random bowler card (0-6)
      const bowlerCard = Math.floor(Math.random() * 7);
      
      // Determine outcome based on format rules
      let runs = 0;
      let isWicket = false;
      let isNoBall = false;
      let isWide = false;
      let isByes = false;
      
      // Apply rules based on format
      if (gameState.format === 'Test') {
        // Test match rules
        if (cardValue === 0 && bowlerCard === 0) {
          runs = 0; // Dot ball
        } else if (cardValue === 0 && bowlerCard > 0) {
          runs = 0; // Dot ball
        } else if (bowlerCard === 0 && cardValue > 0) {
          runs = cardValue; // Batter scores runs
        } else if (cardValue > 0 && bowlerCard > 0) {
          if (cardValue === bowlerCard) {
            isWicket = true; // Wicket
          } else {
            runs = cardValue; // Batter scores runs
          }
        }
      } else {
        // Limited overs rules
        if (cardValue === 0 && bowlerCard === 0) {
          isNoBall = true; // No ball + free hit
          runs = 1;
        } else if (cardValue === 0 && bowlerCard > 0) {
          runs = bowlerCard; // Bowler's card = runs
        } else if (bowlerCard === 0 && cardValue > 0) {
          runs = 0; // Dot ball
        } else if (cardValue > 0 && bowlerCard > 0) {
          if (cardValue === bowlerCard) {
            isWicket = true; // Wicket
          } else {
            runs = cardValue; // Batter scores runs
          }
        }
        
        // Dead over rules for ODI
        if (gameState.format === 'ODI' && gameState.isDeadOver) {
          if (cardValue === 0 && bowlerCard > 0) {
            runs = 0; // Dot ball
          } else if (cardValue === 0 && bowlerCard === 0) {
            runs = 0; // Dot ball
          } else if (bowlerCard === 0 && cardValue > 0) {
            runs = 0; // Dot ball
          }
        }
      }
      
      // Update game state
      gameState.runs += runs;
      gameState.balls++;
      
      // Calculate overs
      const fullOvers = Math.floor(gameState.balls / 6);
      const ballsInOver = gameState.balls % 6;
      gameState.overs = fullOvers + (ballsInOver / 10);
      
      if (isWicket) {
        gameState.wickets++;
        
        // Show wicket animation
        showWicketAnimation();
        
        // Check if all out or innings should end
        if (gameState.wickets >= 10 || (gameState.isTestMatch && gameState.wickets >= 10)) {
          endInnings();
        } else {
          // Select new batter
          selectNewBatter();
        }
      }
      
      if (isNoBall) {
        gameState.isFreeHit = true;
        showNotification("No ball! Free hit awarded.", "info");
      }
      
      // Add to last five deliveries
      const delivery = {
        runs: runs,
        isWicket: isWicket,
        isNoBall: isNoBall,
        isWide: isWide,
        isByes: isByes,
        batter: gameState.currentBatter,
        bowler: gameState.currentBowler
      };
      
      gameState.lastFiveDeliveries.push(delivery);
      if (gameState.lastFiveDeliveries.length > 5) {
        gameState.lastFiveDeliveries.shift();
      }
      
      // Update UI
      updateUI();
      
      // Add to timeline
      addToTimeline(delivery);
      
      // Check for milestones
      checkMilestones();
      
      // Check if over is complete
      if (ballsInOver === 0) {
        endOver();
      }
      
      // Save to Firebase
      saveGameState();
    }
    
    // Update the UI based on game state
    function updateUI() {
      // Update score
      elements.runs.textContent = gameState.runs;
      elements.wickets.textContent = `${gameState.wickets}/0`;
      elements.overs.textContent = gameState.overs.toFixed(1);
      
      // Calculate run rate
      const runRate = gameState.overs > 0 ? (gameState.runs / gameState.overs).toFixed(2) : '0.00';
      elements.runRate.textContent = runRate;
      
      // Update target display in second innings
      if (gameState.isSecondInnings) {
        elements.targetDisplay.style.display = 'block';
        elements.target.textContent = gameState.target;
      } else {
        elements.targetDisplay.style.display = 'none';
      }
      
      // Update player names
      if (gameState.currentBatter) {
        elements.currentBatter.textContent = gameState.currentBatter;
      }
      
      if (gameState.currentBowler) {
        elements.currentBowler.textContent = gameState.currentBowler;
      }
      
      // Update status indicators
      updateStatusIndicators();
      
      // Update over progress
      updateOverProgress();
      
      // Update team names
      elements.battingTeamName.textContent = gameState.battingTeamName;
      elements.bowlingTeamName.textContent = gameState.bowlingTeamName;
      
      // Update match info
      elements.matchFormat.textContent = gameState.format;
      elements.inningsNumber.textContent = gameState.innings;
      elements.matchDay.textContent = gameState.day;
      elements.matchSession.textContent = gameState.session;
      
      // Update mini scorecard
      elements.miniScore.textContent = `${gameState.runs}/${gameState.wickets}`;
      elements.miniOvers.textContent = gameState.overs.toFixed(1);
    }
    
    // Update status indicators (powerplay, free hit, etc.)
    function updateStatusIndicators() {
      elements.statusIndicators.innerHTML = '';
      
      if (gameState.isPowerplay) {
        const indicator = document.createElement('div');
        indicator.className = 'powerplay-indicator';
        indicator.textContent = 'Powerplay';
        elements.statusIndicators.appendChild(indicator);
      }
      
      if (gameState.isFreeHit) {
        const indicator = document.createElement('div');
        indicator.className = 'free-hit-indicator';
        indicator.textContent = 'Free Hit';
        elements.statusIndicators.appendChild(indicator);
      }
      
      if (gameState.isDeadOver) {
        const indicator = document.createElement('div');
        indicator.className = 'dead-over';
        indicator.textContent = 'Dead Over';
        elements.statusIndicators.appendChild(indicator);
      }
    }
    
    // Update over progress display
    function updateOverProgress() {
      elements.ballsContainer.innerHTML = '';
      const ballsInOver = gameState.balls % 6;
      
      for (let i = 0; i < 6; i++) {
        const ball = document.createElement('div');
        ball.className = 'ball empty';
        
        if (i < ballsInOver) {
          // Add appropriate class based on last delivery
          if (gameState.lastFiveDeliveries.length > 0) {
            const lastDelivery = gameState.lastFiveDeliveries[gameState.lastFiveDeliveries.length - 1 - (ballsInOver - i - 1)];
            if (lastDelivery) {
              if (lastDelivery.isWicket) {
                ball.className = 'ball wicket';
                ball.textContent = 'W';
              } else if (lastDelivery.isNoBall) {
                ball.className = 'ball noball';
                ball.textContent = 'N';
              } else if (lastDelivery.isWide) {
                ball.className = 'ball wide';
                ball.textContent = 'Wd';
              } else if (lastDelivery.runs === 0) {
                ball.className = 'ball dot';
                ball.textContent = '';
              } else {
                ball.className = 'ball run';
                ball.textContent = lastDelivery.runs;
              }
            }
          }
        }
        
        elements.ballsContainer.appendChild(ball);
      }
      
      elements.overNumber.textContent = Math.floor(gameState.balls / 6) + 1;
    }
    
    // Add event to timeline
    function addToTimeline(delivery) {
      const over = Math.floor(gameState.balls / 6) + 1;
      const ball = (gameState.balls % 6) || 6;
      
      const timelineItem = document.createElement('div');
      
      if (delivery.isWicket) {
        timelineItem.className = 'timeline-item wicket';
        timelineItem.innerHTML = `
          <div class="timeline-over">${over}.${ball}</div>
          <div class="timeline-event">Wicket! ${delivery.bowler} to ${delivery.batter}</div>
        `;
      } else if (delivery.runs === 4) {
        timelineItem.className = 'timeline-item boundary';
        timelineItem.innerHTML = `
          <div class="timeline-over">${over}.${ball}</div>
          <div class="timeline-event">FOUR! ${delivery.runs} runs</div>
        `;
      } else if (delivery.runs === 6) {
        timelineItem.className = 'timeline-item boundary';
        timelineItem.innerHTML = `
          <div class="timeline-over">${over}.${ball}</div>
          <div class="timeline-event">SIX! ${delivery.runs} runs</div>
        `;
      } else if (delivery.isNoBall) {
        timelineItem.className = 'timeline-item milestone';
        timelineItem.innerHTML = `
          <div class="timeline-over">${over}.${ball}</div>
          <div class="timeline-event">No Ball +1</div>
        `;
      } else {
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `
          <div class="timeline-over">${over}.${ball}</div>
          <div class="timeline-event">${delivery.runs} run${delivery.runs !== 1 ? 's' : ''}</div>
        `;
      }
      
      elements.timeline.appendChild(timelineItem);
      
      // Scroll to bottom
      elements.timeline.scrollLeft = elements.timeline.scrollWidth;
    }
    
    // Show wicket animation
    function showWicketAnimation() {
      // Add screen shake effect
      document.body.classList.add('screen-shake');
      setTimeout(() => {
        document.body.classList.remove('screen-shake');
      }, 500);
      
      // Create stumps animation
      const graphics = document.getElementById('matchGraphics');
      const stumpLeft = document.createElement('div');
      stumpLeft.className = 'stump left';
      graphics.appendChild(stumpLeft);
      
      const stumpMiddle = document.createElement('div');
      stumpMiddle.className = 'stump middle';
      graphics.appendChild(stumpMiddle);
      
      const stumpRight = document.createElement('div');
      stumpRight.className = 'stump right';
      graphics.appendChild(stumpRight);
      
      const bail = document.createElement('div');
      bail.className = 'stump bail';
      graphics.appendChild(bail);
      
      // Animate stumps falling
      setTimeout(() => {
        stumpLeft.style.animation = 'stumpFall 0.5s forwards';
        stumpMiddle.style.animation = 'stumpFall 0.5s 0.1s forwards';
        stumpRight.style.animation = 'stumpFall 0.5s 0.2s forwards';
        bail.style.animation = 'stumpFall 0.5s 0.1s forwards';
      }, 100);
      
      // Remove stumps after animation
      setTimeout(() => {
        graphics.innerHTML = '';
      }, 2000);
    }
    
    // Show boundary animation
    function showBoundaryAnimation(isSix = false) {
      if (isSix) {
        // Golden glow + fireworks for six
        document.body.style.boxShadow = '0 0 30px gold';
        setTimeout(() => {
          document.body.style.boxShadow = '';
        }, 1000);
        
        // Create fireworks
        createFireworks();
      } else {
        // Ripple effect for four
        const ripple = document.createElement('div');
        ripple.className = 'ripple-effect';
        ripple.style.left = '50%';
        ripple.style.top = '50%';
        document.getElementById('matchGraphics').appendChild(ripple);
        
        setTimeout(() => {
          document.getElementById('matchGraphics').innerHTML = '';
        }, 1000);
      }
    }
    
    // Create fireworks animation
    function createFireworks() {
      const graphics = document.getElementById('matchGraphics');
      
      for (let i = 0; i < 20; i++) {
        const firework = document.createElement('div');
        firework.className = 'confetti';
        firework.style.left = Math.random() * 100 + '%';
        firework.style.top = Math.random() * 100 + '%';
        firework.style.backgroundColor = getRandomColor();
        firework.style.animationDelay = Math.random() * 1 + 's';
        graphics.appendChild(firework);
      }
      
      setTimeout(() => {
        graphics.innerHTML = '';
      }, 5000);
    }
    
    // Get random color for fireworks
    function getRandomColor() {
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
    
    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `milestone-notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // Check for milestones
    function checkMilestones() {
      // Check for 50/100 runs
      if (gameState.runs === 50) {
        showNotification("Team Fifty!", "batting");
      } else if (gameState.runs === 100) {
        showNotification("Team Century!", "batting");
      }
      
      // Check for individual milestones (simplified)
      if (gameState.batterStats[gameState.currentBatter] && 
          gameState.batterStats[gameState.currentBatter].runs === 50) {
        showNotification(`${gameState.currentBatter} scores 50!`, "batting");
      }
      
      // Check for bowler milestones (simplified)
      if (gameState.bowlerStats[gameState.currentBowler] && 
          gameState.bowlerStats[gameState.currentBowler].wickets === 3) {
        showNotification(`${gameState.currentBowler} takes 3 wickets!`, "info");
      }
    }
    
    // End over
    function endOver() {
      showNotification("Over complete", "info");
      
      // Change bowler after over (simplified logic)
      setTimeout(() => {
        selectNewBowler();
      }, 2000);
    }
    
    // End innings
    function endInnings() {
      gameState.isInningsBreak = true;
      
      // Show innings summary
      showInningsSummary();
      
      // Save to Firebase
      saveGameState();
    }
    
    // Show innings summary
    function showInningsSummary() {
      const summaryPopup = document.createElement('div');
      summaryPopup.className = 'summary-popup';
      summaryPopup.innerHTML = `
        <h3>Innings Break</h3>
        <div class="summary-content">
          <div class="summary-row">
            <span class="summary-label">Runs:</span>
            <span class="summary-value">${gameState.runs}/${gameState.wickets}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Overs:</span>
            <span class="summary-value">${gameState.overs.toFixed(1)}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Run Rate:</span>
            <span class="summary-value">${(gameState.overs > 0 ? (gameState.runs / gameState.overs).toFixed(2) : '0.00')}</span>
          </div>
          <div class="summary-highlight">
            ${gameState.battingTeamName} innings complete
          </div>
        </div>
        <div class="summary-countdown" id="inningsCountdown">5</div>
        <button id="startNextInnings">Start Next Innings</button>
      `;
      
      document.body.appendChild(summaryPopup);
      summaryPopup.style.display = 'block';
      
      // Countdown timer
      let countdown = 5;
      const countdownElement = document.getElementById('inningsCountdown');
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          startNextInnings();
          summaryPopup.remove();
        }
      }, 1000);
      
      // Start next innings button
      document.getElementById('startNextInnings').addEventListener('click', () => {
        clearInterval(countdownInterval);
        startNextInnings();
        summaryPopup.remove();
      });
    }
    
    // Start next innings
    function startNextInnings() {
      // Swap batting and bowling teams
      const tempTeam = gameState.battingTeam;
      gameState.battingTeam = gameState.bowlingTeam;
      gameState.bowlingTeam = tempTeam;
      
      const tempTeamName = gameState.battingTeamName;
      gameState.battingTeamName = gameState.bowlingTeamName;
      gameState.bowlingTeamName = tempTeamName;
      
      // Reset score but keep target for second innings
      gameState.runs = 0;
      gameState.wickets = 0;
      gameState.balls = 0;
      gameState.overs = 0;
      gameState.innings = 2;
      gameState.isSecondInnings = true;
      gameState.isInningsBreak = false;
      
      // Set target (for demo, set a random target)
      gameState.target = 150 + Math.floor(Math.random() * 100);
      
      // Update UI
      updateUI();
      
      // Save to Firebase
      saveGameState();
    }
    
    // Select new batter
    function selectNewBatter() {
      gameState.isSelectingBatter = true;
      
      // Show selection modal
      elements.modalTitle.textContent = 'Select New Batter';
      elements.selectionList.innerHTML = '';
      
      // Add available batters to the list
      // In a real implementation, this would come from team data
      const availableBatters = ['Player 1', 'Player 2', 'Player 3', 'Player 4', 'Player 5'];
      
      availableBatters.forEach(batter => {
        const item = document.createElement('div');
        item.className = 'batter-item';
        item.textContent = batter;
        item.dataset.id = batter;
        
        item.addEventListener('click', () => {
          // Remove selected class from all items
          document.querySelectorAll('.batter-item').forEach(i => {
            i.classList.remove('selected');
          });
          
          // Add selected class to clicked item
          item.classList.add('selected');
          gameState.selectedCard = batter;
        });
        
        elements.selectionList.appendChild(item);
      });
      
      elements.selectionModal.style.display = 'block';
    }
    
    // Select new bowler
    function selectNewBowler() {
      gameState.isSelectingBowler = true;
      
      // Show selection modal
      elements.modalTitle.textContent = 'Select New Bowler';
      elements.selectionList.innerHTML = '';
      
      // Add available bowlers to the list
      // In a real implementation, this would come from team data
      const availableBowlers = ['Bowler A', 'Bowler B', 'Bowler C', 'Bowler D', 'Bowler E'];
      
      availableBowlers.forEach(bowler => {
        const item = document.createElement('div');
        item.className = 'player-item';
        item.textContent = bowler;
        item.dataset.id = bowler;
        
        item.addEventListener('click', () => {
          // Remove selected class from all items
          document.querySelectorAll('.player-item').forEach(i => {
            i.classList.remove('selected');
          });
          
          // Add selected class to clicked item
          item.classList.add('selected');
          gameState.selectedCard = bowler;
        });
        
        elements.selectionList.appendChild(item);
      });
      
      elements.selectionModal.style.display = 'block';
    }
    
    // Confirm selection
    function confirmSelection() {
      if (!gameState.selectedCard) return;
      
      if (gameState.isSelectingBatter) {
        gameState.currentBatter = gameState.selectedCard;
        gameState.isSelectingBatter = false;
      } else if (gameState.isSelectingBowler) {
        gameState.currentBowler = gameState.selectedCard;
        gameState.isSelectingBowler = false;
      }
      
      // Hide modal
      elements.selectionModal.style.display = 'none';
      gameState.selectedCard = null;
      
      // Update UI
      updateUI();
      
      // Save to Firebase
      saveGameState();
    }
    
    // Declare innings (Test matches only)
    function declareInnings() {
      if (!gameState.isTestMatch) return;
      
      if (confirm("Are you sure you want to declare the innings?")) {
        gameState.isDeclared = true;
        endInnings();
      }
    }
    
    // Save game state to Firebase
    function saveGameState() {
      db.collection('matches').doc(gameState.matchId).update({
        runs: gameState.runs,
        wickets: gameState.wickets,
        balls: gameState.balls,
        overs: gameState.overs,
        currentBatter: gameState.currentBatter,
        currentBowler: gameState.currentBowler,
        isPowerplay: gameState.isPowerplay,
        isFreeHit: gameState.isFreeHit,
        isDeadOver: gameState.isDeadOver,
        innings: gameState.innings,
        target: gameState.target,
        isDeclared: gameState.isDeclared,
        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        console.log('Game state saved successfully');
      })
      .catch((error) => {
        console.error('Error saving game state:', error);
        showError('Failed to save game state');
      });
    }
    
    // Exit game
    function exitGame() {
      if (confirm("Are you sure you want to exit the match?")) {
        window.location.href = 'index.html';
      }
    }
    
    // Reset plays
    function resetPlays() {
      if (confirm("Reset all plays for this over? This cannot be undone.")) {
        // Reset balls and last deliveries for current over
        const currentOver = Math.floor(gameState.balls / 6);
        gameState.balls = currentOver * 6;
        gameState.overs = currentOver;
        
        // Remove deliveries from current over
        gameState.lastFiveDeliveries = gameState.lastFiveDeliveries.filter(d => {
          const deliveryOver = Math.floor(d.ballNumber / 6);
          return deliveryOver < currentOver;
        });
        
        // Update UI
        updateUI();
        
        // Save to Firebase
        saveGameState();
      }
    }
    
    // Show error message
    function showError(message) {
      elements.result.textContent = message;
      elements.result.classList.add('error');
      
      setTimeout(() => {
        elements.result.textContent = '';
        elements.result.classList.remove('error');
      }, 3000);
    }
    
    // Populate teams modal
    function populateTeamsModal(matchData) {
      elements.team1Name.textContent = matchData.team1Name || 'Team 1';
      elements.team2Name.textContent = matchData.team2Name || 'Team 2';
      
      // Clear existing lists
      elements.team1Players.innerHTML = '';
      elements.team2Players.innerHTML = '';
      
      // Add players to team 1 (simplified)
      const team1Players = matchData.team1Players || ['Player 1', 'Player 2', 'Player 3', 'Player 4', 'Player 5'];
      team1Players.forEach(player => {
        const li = document.createElement('li');
        li.textContent = player;
        elements.team1Players.appendChild(li);
      });
      
      // Add players to team 2 (simplified)
      const team2Players = matchData.team2Players || ['Player A', 'Player B', 'Player C', 'Player D', 'Player E'];
      team2Players.forEach(player => {
        const li = document.createElement('li');
        li.textContent = player;
        elements.team2Players.appendChild(li);
      });
    }
    
    // Show teams modal
    function showTeamsModal() {
      elements.teamsModal.style.display = 'flex';
    }
    
    // Hide teams modal
    function hideTeamsModal() {
      elements.teamsModal.style.display = 'none';
    }
    
    // Show previous team
    function showPreviousTeam() {
      elements.teamsContainer.scrollLeft -= elements.teamsContainer.clientWidth;
      updateTeamNavButtons();
    }
    
    // Show next team
    function showNextTeam() {
      elements.teamsContainer.scrollLeft += elements.teamsContainer.clientWidth;
      updateTeamNavButtons();
    }
    
    // Update team navigation buttons
    function updateTeamNavButtons() {
      const scrollPos = elements.teamsContainer.scrollLeft;
      const containerWidth = elements.teamsContainer.clientWidth;
      
      elements.prevTeamBtn.disabled = scrollPos === 0;
      elements.nextTeamBtn.disabled = scrollPos >= containerWidth;
      
      // Update nav dots
      const dots = document.querySelectorAll('.team-nav-dot');
      const activeIndex = Math.round(scrollPos / containerWidth);
      
      dots.forEach((dot, index) => {
        if (index === activeIndex) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    }
    
    // Update target display
    function updateTargetDisplay() {
      if (gameState.isSecondInnings) {
        const runsNeeded = gameState.target - gameState.runs;
        const wicketsRemaining = 10 - gameState.wickets;
        const ballsRemaining = Math.floor((gameState.format === 'Test' ? gameState.oversPerDay * 6 : getMaxOvers() * 6) - gameState.balls);
        
        elements.tickerText.textContent = `Need ${runsNeeded} runs from ${ballsRemaining} balls with ${wicketsRemaining} wickets in hand`;
      }
    }
    
    // Get max overs based on format
    function getMaxOvers() {
      switch (gameState.format) {
        case 'T5': return 5;
        case 'T10': return 10;
        case 'T20': return 20;
        case 'ODI': return 50;
        case 'Test': return gameState.oversPerDay;
        default: return 20;
      }
    }
    
    // Initialize the game when the page loads
    window.addEventListener('load', initGame);
  </script>
</body>
</html>
